# Kimchi Invasion — Cursor Context MD (v0.56)
> 목적: 이 문서는 **Cursor 에이전트가 그대로 읽고 구현**할 수 있는 “구현 중심 컨텍스트”다.  
> 원칙: **가정 금지**(불명확하면 질문), **단계적 구현**, **UI/시스템은 단순-확장형**, **중복/누락 없이(MECE)**.

---

## 0. 목차 (이 순서대로 작성/구현)
0) 목차/문서 사용법  
1) 게임 한 줄 정의 + 핵심 재미(디자인 원칙)  
2) 플레이 루프(초반→자동화→프레스티지)  
3) 리소스/지표/용어(Glossary)  
4) 제품 라인/레시피 트리(Act1 기준 + 확장 규칙)  
5) 라인 시스템(라인 설치/철거/할당)  
6) 3레버 시스템(공급/물류/수요) 상세  
7) 자동화(인력/설비/시장/조직) — “아이템 재고” 방식  
8) UI/UX (PC 5열 오픈 / 모바일 5탭) + 인벤/창고 “녹이기” 규칙  
9) 연구 시스템(효소 기반) + 해금/제출 규칙  
10) 업적/통계/메타 진행(로그, 리플레이 동기)  
11) 엔딩/프레스티지(서울타워 → 스타김치십 발사) + 외계물질 보상  
12) Act 확장 로드맵(Act2 글로벌, Act3 우주) — 유저는 자연스럽게 넘어가게  
13) 데이터 모델/상태머신/저장 포맷(구현 가이드)  
14) 구현 체크리스트(스프린트 단위) + 테스트 포인트

---

# 1. 게임 한 줄 정의 + 핵심 재미(디자인 원칙)

## 1.1 한 줄 정의
**김치를 “라인(생산→물류→판매)”으로 굴리며 병목을 조정하고 자동화를 확장해, 최종적으로 서울타워에서 ‘스타김치십’을 발사한 뒤 프레스티지로 반복 성장하는 클리커/운영 게임.**

## 1.2 핵심 재미(절대 유지)
- **클리커 감성**: 초반엔 “내 클릭”이 전부다. (생산/물류/판매 모두 클릭 기반으로 시작)
- **운영 최적화 묘미**:  
  생산이 과하면 재고가 쌓이고, 물류가 약하면 이동이 막히고, 판매가 약하면 Sell 재고가 쌓인다.  
  반대로 판매가 너무 강하면 생산분이 족족 팔려 “연구/해금용 재고”가 모이지 않는다.  
  → 이 “미스매치 밸런싱”이 게임의 중심 재미다.
- **단순한 병목 축**: 병목은 복잡하게 쪼개지지 않는다.  
  핵심 병목은 3가지: `생산량(속도/배치량)`, `물류 이동`, `판매 처리`.
- **가격은 고정**: 유저가 가격을 직접 조정하지 않는다. (단가 튜닝은 밸런스에서 관리)
- **돈의 역할**: 돈은 “생산 재료”가 아니다.  
  돈은 **설비/인력/시장/조직/라인 설치/연구(일부)**에만 사용한다.
- **재고는 제품별로 따로 존재**: 각 제품은 재고/Cap이 별도로 있다.
- **인벤(자산) = 아이템**: 인력/설비/시장/조직은 “구매하면 재고에 쌓이는 아이템”이며, 라인에 장착해서 효과를 낸다.  
  라인 철거 시 장착 아이템은 **파괴되지 않고 재고로 회수**된다. (다른 라인에 재장착/판매 가능)

---

# 2. 플레이 루프(초반→자동화→프레스티지)

## 2.1 초반(완전 클리커)
초반에는 **세 가지 클릭**이 전부다.
1) **생산 클릭**: 클릭하면 해당 라인의 제품 1개 생산(또는 배치량만큼 생산).
2) **물류 클릭**: 클릭하면 재고를 `Keep(보관)` 또는 `Sell(판매대기)`로 이동.
3) **판매 클릭**: 클릭하면 Sell에서 1개 판매(또는 판매량만큼 판매) → 현금 획득.

> Keep은 “레시피/연구/해금 제출”을 위해 남겨두는 보호 재고.  
> Sell은 “판매로 소진되는 재고 풀”.

## 2.2 중반(자동화 시작: 클릭의 귀찮음을 돈으로 해결)
유저의 클릭을 대체하는 자동화 아이템이 등장한다.
- **생산 자동화**: 작업인력(속도) + 생산설비(배치량)
- **물류 자동화**: 물류인력이 Keep↔Sell로 자동 이동
- **판매 자동화**: 시장(판매속도) + 판매조직(판매량/효율) + 판매인력(자동판매 클릭)

> 자동화는 “한 번에 다”가 아니라, 항상 **가장 큰 병목을 풀어주는 레버**를 선택하도록 설계한다.

## 2.3 후반(제품 트리/연구/엔딩 빌드업)
- 상급 제품은 하위 제품을 요구하며(팩토리오 감성),  
  라인 밸런스를 잘 못 맞추면 “필요한 재고가 모이지 않거나, Sell로 흘러가버려서” 진행이 막힌다.
- **김치효소(Enzyme)**는 연구 전용 재화로, “김치류 제품”에서만 나온다.  
  따라서 후반에도 김치류 라인을 완전히 멈출 수 없다. (근본 유지)

## 2.4 엔딩 & 프레스티지(반복 성장)
- 최종 엔딩은 “서울타워에서 **스타김치십(Star Kimchi Ship)** 발사”.
- 발사 후 프레스티지로 리셋하되, **외계물질(Alien Matter, AM)**을 획득해 “근본 버프”를 얻는다.
- AM 버프는 “영구 구조물”이 아니라 **프레스티지 보상(메타 업그레이드)**만 제공한다.

---

> 여기까지가 1부(0~2장).  
> 다음 메시지에서 **3장(리소스/용어)부터** 목차 순서대로 이어서 작성한다.

# Kimchi Invasion — Cursor Context MD (v0.56) — Part 2
> 이어서: 목차 3)~5)

---

# 3. 리소스/지표/용어(Glossary)

## 3.1 주요 리소스(재화)
### (A) 현금(Cash, ₩)
- 획득: 판매(Sell 재고를 판매할 때)
- 사용: 라인 설치비, 아이템 구매(설비/인력/시장/조직), 연구(일부), 업그레이드
- 금지: 제품 생산 “재료”로 사용하지 않는다.

### (B) 김치효소(Enzyme, 🧪)
- 개념: 연구 전용 재화
- 획득: **김치류 제품** 생산/판매 과정에서만 산출 (가공식품/미래산업류에서는 기본적으로 산출 X)
- 사용: 연구 해금에만 사용(초기 설계)
- 핵심 제약: 효소 수급 때문에 김치류 라인을 완전히 멈출 수 없도록 설계한다.

### (C) 외계물질(Alien Matter, AM, ✨)
- 개념: 프레스티지 보상 재화
- 획득: 스타김치십 발사(엔딩) 후 프레스티지 시 지급
- 사용: 메타 업그레이드(근본 버프). “영구 구조물”은 만들지 않는다.

## 3.2 재고(Inventory) — 제품별 3구획
각 제품(Product)은 “총 재고”가 아니라 아래 3개의 숫자를 가진다.
- `keep_qty`: 보관(레시피/연구/제출 보호)
- `sell_qty`: 판매 대기(판매가 여기서만 소진)
- `cap`: 해당 제품의 최대 보유 가능량(keep+sell 합산 기준)

표기:
- `total_qty = keep_qty + sell_qty`
- 상태 뱃지 예시:
  - `CAP_FULL`: total_qty >= cap
  - `SELL_EMPTY`: sell_qty == 0
  - `KEEP_EMPTY`: keep_qty == 0

> “창고”는 별도 화면이 아니라, 물류 UI(keep↔sell 이동)로 관리한다.

## 3.3 라인(Line)
- 라인은 “하나의 제품”을 담당한다.
- 라인은 3개 섹션 UI를 가진다: 생산 / 물류 / 판매
- 라인에는 장착 슬롯이 있다(아이템 장착으로 성능 변화):
  - 생산: 설비(배치량), 작업인력(속도)
  - 물류: 물류인력(이동)
  - 판매: 시장(판매속도), 판매조직(판매량/효율), 판매인력(자동판매)

## 3.4 아이템(Item, 자산 재고)
- 인력/설비/시장/조직은 “업그레이드 트리”가 아니라 **구매 가능한 아이템**.
- 구매하면 `item_inventory`에 수량으로 누적
- 라인에 장착하면 해당 라인의 슬롯을 점유
- 라인 철거/제품 변경 시에도 아이템은 파괴되지 않고 재고로 회수 가능
- 아이템은 판매(환급) 가능

## 3.5 “속도/배치량/이동/판매량” 정의
- `batch`(배치량): 생산 클릭 1회당 생산되는 제품 수
- `prod_speed`(생산속도): 초당 자동 생산 횟수(작업인력 영향)
- `move_speed`(물류이동): 초당 keep↔sell로 옮기는 수량(물류인력 영향)
- `sell_speed`(판매속도): 초당 판매 “시도” 횟수(시장 영향)
- `sell_amount`(판매량/효율): 1회 판매 시 몇 개를 파는지(판매조직 영향)
- `auto_click`(자동클릭): 판매 버튼 클릭을 자동으로 누르는 느낌(판매인력)

---

# 4. 제품 라인/레시피 트리(Act1 기준 + 확장 규칙)

## 4.1 라인 분류(Act1)
### 라인 A: 김치 라인(효소 산출 라인)
1) 배추김치  
2) 깍두기  
3) 파김치  
4) 묵은지  
5) 100년숙성

### 라인 B: 식품 라인(가공식품)
1) 김치소스  
2) 김치볶음밥  
3) 김치탕수육  
4) 김치파스타  
5) 김치파인다이닝

> 이후(Act2/3) 확장: 미래산업/우주선 재료 라인은 별도 장에서 정의(목차 12).

## 4.2 가격(단가) 원칙
- 가격은 고정(유저 조정 없음)
- “현실감 유지”: 배추김치는 1원 같은 값 금지. 초반부터 5,000원 단위로 출발.
- 상위 제품 단가가 너무 비현실적으로 튀지 않도록, **현실적 범위 + 게임적 성장**을 동시에 만족하는 곡선을 사용한다.
- 최종 엔딩급 모듈/재료는 충분히 높은 단가로 플레이타임을 확보한다.
> 단가 테이블은 밸런스 파트에서 추후 숫자 확정(현재는 원칙만 고정).

## 4.3 레시피 트리 규칙(팩토리오 감성, 과복잡 금지)
### 핵심 룰
1) **상위 제품은 하위 제품을 요구**한다. (단, “돈”은 생산 재료로 섞지 않는다)
2) “납득 가능한 수준”에서 조합한다. (현실/서사 기반)
3) **각 라인의 최종제품(5번)은:**
   - 같은 라인 1~4번 제품을 요구 +  
   - “직전 라인(이전 라인) 1번 제품”을 추가로 요구한다.
   - 예) 식품라인 최종(김치파인다이닝)은 식품 1~4 + 김치라인 1번(배추김치) 요구
4) 중간 제품(2~4번)도 하위 제품을 적절히 요구한다.
5) 레시피 요구량은 “한 번에 너무 많은 품목”으로 늘리지 않는다(인지부하 방지).
   - 추천: 제품당 입력은 최대 2~3종.

### 레시피(초안) — 김치 라인
- 배추김치: (기본 생산, 재료 없음)
- 깍두기: 배추김치 일부 요구(예: 배추김치 xN)
- 파김치: 배추김치 일부 요구
- 묵은지: 배추김치 + 깍두기(또는 파김치) 중 1개 요구
- 100년숙성(최종): 배추김치 + 깍두기 + 파김치 + 묵은지 (전체 요구)

### 레시피(초안) — 식품 라인
- 김치소스: 배추김치 요구(소스 베이스 현실성)
- 김치볶음밥: 김치소스 + 배추김치(또는 깍두기)
- 김치탕수육: 김치소스 + 김치볶음밥(또는 파김치)
- 김치파스타: 김치소스 + 김치탕수육
- 김치파인다이닝(최종): 김치소스 + 볶음밥 + 탕수육 + 파스타 + 배추김치

> 위 레시피의 “구체 수량(N)”은 밸런스 단계에서 조정.  
> 지금은 **구조/의존성**만 확정한다.

## 4.4 효소 산출 규칙(확정)
- 효소는 “김치 라인 제품”에서만 산출
- 배추김치가 **금전적 이익은 낮지만 효소 산출이 최강**인 포지션
- 효소 개념은 초반부터 노출하지 않는다.
- `발효실험실` 업그레이드(연구) 이후부터 효소 채취/표시/사용이 열린다.

---

# 5. 라인 시스템(라인 설치/철거/할당)

## 5.1 라인 개념
- 라인은 “제품을 굴리는 작업대”
- 라인마다 1개 제품만 할당 가능
- 라인 수는 늘릴 수 있고, 철거도 가능
- 라인 철거/변경은 **전략 행동**이며, 자산(아이템) 회수/재배치가 가능해야 한다.

## 5.2 라인 설치
- 라인 설치비는 현금으로 지불
- 설치 시 “빈 라인(미할당)” 생성 → 제품을 선택해 할당해야 가동
- 설치비 증분 규칙(초안):
  - `cost = base_cost * (growth ^ (line_count-1))`
  - base_cost/growth는 밸런스에서 확정(원칙만 고정)

## 5.3 라인 철거
- 철거 시:
  - 라인의 제품 할당 해제
  - 라인에 장착된 아이템(설비/인력/시장/조직)은 **모두 재고로 자동 회수**
  - 제품 재고(keep/sell)는 “제품 자체의 재고”로 남는다(제품별 재고는 시스템에 유지)
- 철거 환급:
  - 설치비의 일부 환급(예: 50%) 또는 0% (향후 선택)
  - 원칙: 라인 스위칭이 공짜로 남용되지 않게 설계

## 5.4 라인 제품 변경(재할당)
- 라인에서 제품을 변경할 수 있다.
- 변경 시:
  - 장착 아이템은 기본적으로 “호환 여부”에 따라 처리
    - 호환 아이템(예: 물류인력)은 그대로 유지 가능
    - 비호환(예: 특정 제품 전용 설비)은 자동 해제(재고로 회수)
- 변경은 “라인 철거 후 재설치”보다 UX가 쉬워야 한다.

---

> 여기까지가 Part 2 (3~5장).  
> 다음 Part 3에서는 6) 3레버 시스템 상세와 7) 자동화/아이템을 “구현 규칙” 수준으로 쓴다.

# Kimchi Invasion — Cursor Context MD (v0.56) — Part 3
> 이어서: 목차 6)~7)

---

# 6. 3레버 시스템(공급/물류/수요) 상세

## 6.1 전체 구조(라인 단위)
각 라인은 아래 흐름을 가진다.

[생산] → (생산된 수량이 제품 재고에 추가) → [물류: Keep 또는 Sell로 분류/이동] → [판매: Sell에서만 판매]

- 생산은 제품 재고를 늘린다.
- 물류는 제품 재고를 `keep_qty`와 `sell_qty`로 나눈다(이동).
- 판매는 `sell_qty`를 감소시키고 현금을 증가시킨다.

## 6.2 공급 레버(Production)
공급은 2개의 레버로 표현한다. (서사/이해를 쉽게)
- **생산설비(Equipment)**: “클릭/사이클 1회당 생산량” = `batch`
- **작업인력(Workers)**: “자동 생산 속도” = `prod_speed`

### 6.2.1 생산 규칙
- 생산 클릭 시:
  - `produce(batch)` 실행
  - 단, `total_qty + batch > cap`이면 cap을 초과하지 않는 범위까지만 생산되거나, 생산 실패(정책 택1)
- 자동 생산:
  - `prod_speed`에 따라 주기적으로 생산 클릭이 자동으로 발생하는 것처럼 동작
- 생산 중단 조건:
  - 기본: `total_qty >= cap`이면 자동 생산이 중단됨(팩토리오 창고 꽉 참)
  - 클릭 생산은 “cap 도달 시 실패”로 처리

### 6.2.2 공급/병목 피드백(유저에게 보여줄 신호)
- 상태 뱃지:
  - `CAP_FULL`: 생산이 막힘(재고 꽉 참)
  - `RUNNING`: 정상 가동
- UI에서 “왜 멈췄는지” 한 줄로 설명:
  - “창고가 꽉 찼다(총재고/cap). 물류/판매를 강화해라.”

## 6.3 물류 레버(Logistics)
물류는 “재고 분류/이동” 레버다.
- **물류인력(Logistics Staff)**: 초당 Keep↔Sell 이동량 = `move_speed`
- **방향(Direction)**: Keep 우선 / Sell 우선 (유저가 선택)

### 6.3.1 물류 규칙(핵심 확정)
- 초기(클리커):
  - 유저가 물류 버튼을 클릭해 1개씩 이동(또는 `move_click_amount`)
  - 이동 방향은 유저가 클릭 시 선택(Keep로 넣기 / Sell로 보내기)
- 자동화 이후:
  - 물류인력이 정해진 방향으로 자동 이동
  - 방향 토글:
    - `KEEP_PRIORITY`: Sell→Keep 또는 생산분을 우선 Keep에 쌓도록 유도
    - `SELL_PRIORITY`: Keep→Sell 또는 생산분을 우선 Sell로 보내도록 유도
- 물류는 “신규 생산분을 어디로 둘지”가 아니라,
  - 구현 상 단순화를 위해: 생산은 일단 “미분류 풀”로 넣지 않고,
  - **생산 시 곧바로 keep 또는 sell로 들어간다**(정책 택1)
    - 정책 추천: “기본은 Keep으로 들어간다” (연구/레시피 확보에 유리)
    - 이후 물류가 Keep↔Sell로 이동시키며 밸런싱
  - 단, 이 정책은 UX/밸런스에 큰 영향 → 구현 전에 질문/확정 필요

> NOTE(중요): 위 ‘생산 직후 기본 분류(Keep 기본)’는 아직 “추천”이며,
> 실제 구현 전 유저(기획자)에게 최종 확정 질문을 한다.

### 6.3.2 물류 병목 신호
- `KEEP_EMPTY`인데 상위 제품 레시피/연구가 막히면:
  - “Keep 부족” 경고
- `SELL_EMPTY`면 판매가 못 돎:
  - “Sell 부족” 경고
- `CAP_FULL`인데 sell이 비어있으면:
  - “물류가 막혔다” 경고

## 6.4 수요 레버(Demand / Sales)
수요는 2개의 레버로 표현한다(유저 이해 매칭).
- **시장(Market)**: 판매 속도(초당 판매 시도 횟수) = `sell_speed`
  - 예시 서사 단계: 재래시장 → 슈퍼마켓 → 온라인몰 → 기업급식납품 → ...
- **판매조직(Sales Org)**: 1회 판매당 판매량/효율 = `sell_amount`
  - 예시 서사 단계: 기본 클릭 → 알바 → 계약직 → 영업팀 → 영업본부 → 해외지사

+ (보조) **판매인력(Sales Staff)**: 자동 판매 클릭(클리커 대체)

### 6.4.1 판매 규칙
- 판매는 오직 `sell_qty`에서만 차감
- 판매 클릭 시:
  - `sell(min(sell_amount, sell_qty))` 실행
- 자동 판매:
  - `sell_speed`에 따라 주기적으로 판매가 발생
  - 단, sell_qty가 0이면 판매는 발생하지 않음

### 6.4.2 수요 병목 신호
- 생산/물류가 잘 돌아도 `sell_speed`가 낮으면 Sell 재고가 쌓인다.
- `sell_speed`가 너무 높으면 생산분이 즉시 판매되어 Keep이 모이지 않는다.
- 이 “미스매치”가 게임의 재미가 되도록 경고/상태 표시를 제공한다.

---

# 7. 자동화(인력/설비/시장/조직) — “아이템 재고” 방식

## 7.1 핵심 철학(확정)
- 업그레이드는 “트리”가 아니라 **구매 가능한 아이템**
- 아이템은 재고로 쌓이며, 라인에 장착해서 효과 적용
- 라인 철거/변경 시 아이템은 재고로 회수
- 아이템은 판매(환급) 가능

## 7.2 아이템 타입(슬롯 매핑)
각 라인에는 아래 슬롯이 존재한다.

### 생산 슬롯
1) 생산설비(Equipment Slot)
- 효과: `batch` 증가 (클릭/사이클당 생산량)
- 단계(서사 기반, 5단계 이상):
  1. 엄마김치(집 냉장고)  ← “1단계(티어1)”로 취급
  2. 부녀회 김치냉장고
  3. 동네 공동 작업장
  4. 소규모 공방 설비
  5. HACCP 소규모 공장
  (이후 확장 가능)

2) 작업인력(Workers Slot)
- 효과: `prod_speed` 증가(자동 생산 속도)
- 단계(5단계 이상):
  1. 나(혼자)
  2. 가족 도움
  3. 동네 알바
  4. 작업반(팀)
  5. 교대조 운영

### 물류 슬롯
3) 물류인력(Logistics Slot)
- 효과: `move_speed` 증가(초당 Keep↔Sell 이동량)
- 단계(5단계 이상):
  1. 손수레
  2. 카트
  3. 창고 담당
  4. 물류팀
  5. 자동 분류 시스템(연구 해금)

> 추가 규칙: 유저가 “물류인력은 배치(Keep로/ Sell로)”를 원함.
- 최소 구현: 라인별 물류 방향 토글(KEEP_PRIORITY / SELL_PRIORITY)
- 확장 구현: 물류인력에 “배치 모드” 추가(예: Keep 전담 / Sell 전담)

### 판매 슬롯
4) 시장(Market Slot)
- 효과: `sell_speed` 증가(초당 판매 시도)
- 단계(5단계 이상):
  1. 동네 장터
  2. 슈퍼 납품
  3. 온라인몰
  4. 프랜차이즈 납품
  5. 기업급식/대형 유통

5) 판매조직(Sales Org Slot)
- 효과: `sell_amount` 증가(1회 판매당 판매 수량) 또는 “판매 효율” 계수
- 단계(5단계 이상):
  1. 직접 판매(기본)
  2. 알바 고용
  3. 계약직
  4. 영업팀
  5. 영업본부(해외지사 등은 Act2 확장)

6) 판매인력(Sales Staff Slot)
- 효과: 판매 버튼 자동 클릭/자동 판매 “클리커 대체”
- 단계(선택):
  1. 없음
  2. 판매사원 1명
  3. 판매사원 3명
  4. 판매팀
  5. 자동 주문 처리

## 7.3 구매/장착/판매 UX 규칙(창고/자산 화면 없이 “녹이기”)
- 아이템을 관리하는 별도 “자산 페이지”는 없다.
- 각 슬롯을 클릭하면 그 자리에서:
  - “장착 가능한 아이템 목록(보유 수량/가격)”이 드롭다운/팝오버로 열린다.
  - `[장착] [판매(환급)] [구매]`를 동일 UI에서 처리한다.
- 컬럼 상단에 “+구매” 진입점(인라인 패널) 제공:
  - 생산 컬럼 상단: 생산설비/작업인력 구매
  - 물류 컬럼 상단: 물류인력 구매
  - 판매 컬럼 상단: 시장/조직/판매인력 구매

## 7.4 “아이템 재고” 데이터 규칙
- `item_inventory[item_id] = count`
- 장착 시:
  - inventory count 감소(또는 “장착=대여”로 별도 tracking) — 정책 택1
  - 추천: 장착하면 inventory에서 1 감소, 해제하면 1 증가(직관)
- 판매 시:
  - inventory count 감소
  - 현금 증가(환급률은 밸런스에서)

## 7.5 자동화의 기본 수식(초안)
- `effective_batch = base_batch + sum(equipment_mods)`
- `effective_prod_speed = base + sum(worker_mods)`
- `effective_move_speed = base + sum(logistics_mods)`
- `effective_sell_speed = base + sum(market_mods)`
- `effective_sell_amount = base + sum(sales_org_mods)`
- 판매인력은 `auto_sell_clicks_per_sec`로 구현 가능

---

> 여기까지가 Part 3 (6~7장).  
> 다음 Part 4에서는 8) UI/UX(PC 5열 / 모바일 5탭) “구현 스펙”과
> 9) 연구(효소/발효실험실) 해금 규칙을 이어서 작성한다.

# Kimchi Invasion — Cursor Context MD (v0.56) — Part 4
> 이어서: 목차 8)~9)

---

# 8. UI/UX (PC 5열 오픈 / 모바일 5탭) + “창고/자산 녹이기” 규칙

## 8.1 UI 목표
- SeoulSurvival “유니폼”을 유지한다(카드 스타일, 정보 밀도, 버튼 톤).
- PC는 캡쳐2처럼 **5개 섹션(생산/물류/판매/연구/통계)이 동시에 열린 5열 레이아웃**.
- 모바일은 SeoulSurvival 모바일처럼 **동일한 5개 섹션을 탭으로 분리**한다(노출되는 섹션은 동일).
- “창고(제품 재고)”와 “자산(아이템 인벤)”은 별도 탭/페이지로 두지 않고,
  - 생산/물류/판매 UI 내부에서 **맥락 기반(인컨텍스트)**으로 조작 가능해야 한다.

---

## 8.2 PC 레이아웃(고정 5열)
### 8.2.1 구조
- 화면은 5개의 컬럼으로 구성:
  1) 생산
  2) 물류
  3) 판매
  4) 연구
  5) 통계

- 생산/물류/판매(1~3열)은 “라인 리스트”를 동일 순서로 렌더링한다.
- 연구/통계(4~5열)는 고정 패널(카드형). 라인 리스트를 반복 표시하지 않는다.

### 8.2.2 라인 정렬 규칙(매우 중요)
- 라인 i는 생산/물류/판매 3열에서 같은 “행”으로 대응되어야 한다.
- 따라서 구현은 아래 중 택1:
  - (A) 3열 각각에 라인 리스트를 렌더링하되, 라인 카드 높이를 고정(또는 최소 동일)으로 맞춘다.
  - (B) 3열을 하나의 그리드(row)로 묶어서 라인 카드 3개를 같은 row에 배치한다. (권장)
- 권장(B):
  - `LineRow` 컴포넌트가 있고, 내부에 3개의 카드(ProdCard/LogiCard/SalesCard)를 나란히 둔다.

### 8.2.3 헤더
- 상단 헤더에 공통 자원 표시:
  - Cash, Enzyme, AM
- 설정(⚙️)은 헤더 우측 고정(설정은 별도 모달/페이지 가능)
- 창고/자산 버튼은 **없다**(요구사항). 대신 인컨텍스트 조작으로 대체한다.

---

## 8.3 모바일 레이아웃(5탭)
### 8.3.1 구조
- 하단 탭 5개:
  - 생산 / 물류 / 판매 / 연구 / 통계
- 탭 선택 시 해당 섹션만 표시
- 생산/물류/판매 탭에는 라인 리스트가 보이며,
  - 해당 탭에 맞는 카드(ProdCard 또는 LogiCard 또는 SalesCard)만 렌더링한다.
- 연구/통계 탭은 PC의 연구/통계 패널과 동일 컴포넌트를 단독 화면으로 보여준다.

### 8.3.2 인컨텍스트 팝업 정책
- PC: 슬롯 클릭 → 팝오버/드롭다운
- 모바일: 슬롯 탭 → 바텀시트(Bottom Sheet)
- 별도 “자산/창고 페이지”는 만들지 않는다.

---

## 8.4 “창고(재고)”를 UI에 녹이는 방식(확정)
### 8.4.1 기본 원칙
- 제품 재고(keep/sell/cap)는 각 라인의 물류 카드(LogiCard)에서 항상 보인다.
- 사용자는 “물류=창고관리”로 인식한다.

### 8.4.2 LogiCard 필수 UI 요소
- 제품명/라인명
- 재고: `Keep / Sell / Cap` (항상 노출)
- 상태 뱃지:
  - CAP_FULL, SELL_EMPTY, KEEP_LOW(정의는 밸런스/임계치에 따라)
- 물류인력 슬롯(장착/해제/구매/판매 진입)
- 방향 토글:
  - Keep 우선 / Sell 우선
- 클릭 기반 물류 버튼(초반):
  - `[Keep로 이동]` `[Sell로 이동]`
  - 클릭 시 1개(또는 click_amount) 이동

### 8.4.3 “전체 재고 보기”를 별도 페이지 없이 제공(선택)
- 물류 컬럼 상단(PC) / 물류 탭 상단(모바일)에
  - `재고 요약바`를 1줄로 제공:
    - “Cap 임박 TOP3 / Keep 부족 TOP3 / Sell 부족 TOP3”
- 클릭 시 **해당 영역 안에서만** 간단 리스트가 펼쳐짐(오버레이 X, 페이지 X)

---

## 8.5 “자산(아이템 인벤)”을 UI에 녹이는 방식(확정)
### 8.5.1 기본 원칙
- 자산은 “슬롯을 클릭하는 순간에만” 노출된다.
- 유저는 현재 라인/현재 슬롯 맥락에서 필요한 아이템만 본다.

### 8.5.2 슬롯 공통 동작
슬롯 클릭/탭 시:
- 장착 가능한 아이템 목록 표시(필터 적용)
- 항목은 아래 정보 포함:
  - 아이템명, 티어, 효과 요약(+batch, +speed 등)
  - 보유 수량
  - 가격(구매)
  - 환급(판매)
- 버튼:
  - `[장착] [구매] [판매]`
- 현재 장착품은 상단에 고정 표시 + `[해제]`

> 장착/해제는 즉시 반영, 상태 저장.

### 8.5.3 컬럼별 슬롯 정의(재확인)
- 생산 카드(ProdCard):
  - 설비 슬롯(배치량)
  - 작업인력 슬롯(생산속도)
- 물류 카드(LogiCard):
  - 물류인력 슬롯(이동속도)
- 판매 카드(SalesCard):
  - 시장 슬롯(판매속도)
  - 판매조직 슬롯(판매량/효율)
  - 판매인력 슬롯(자동판매)

---

## 8.6 생산/물류/판매 카드의 “최소 UI”(정보 과밀 방지)
### 8.6.1 ProdCard 최소 요소
- 제품명/라인명
- 생산 버튼(클릭)
- 생산 상태(정상/CapFull)
- 현재 성능:
  - batch(클릭당 생산량)
  - prod_speed(초당 자동 생산)
- 슬롯 2개(설비/작업인력)

### 8.6.2 LogiCard 최소 요소
- Keep/Sell/Cap + 상태
- 물류 클릭 버튼(Keep로/Sell로)
- 물류 방향 토글
- 물류인력 슬롯

### 8.6.3 SalesCard 최소 요소
- 판매 버튼(클릭)
- 단가(고정)
- sell_speed / sell_amount 요약
- 슬롯 3개(시장/조직/판매인력)
- Sell 재고 0이면 “판매 불가” 표시

---

# 9. 연구 시스템(효소 기반) + 해금/제출 규칙

## 9.1 연구의 목적
- 단순한 “스탯 업”이 아니라,
  - 새로운 기능을 열고(예: 효소 개념 오픈, 자동화 고급 옵션)
  - 생산/물류/판매의 병목 해소 레버를 확장하는 역할

## 9.2 연구 탭 구조
- 연구는 2개 영역으로 구성:
  1) 지구 연구(Earth R&D): Act1 중심(발효/가공/유통)
  2) AM 연구소(Alien Matter Lab): 프레스티지 이후 메타 업그레이드

PC는 연구 컬럼(4열)에, 모바일은 연구 탭에 동일 컴포넌트로 표시.

## 9.3 효소(Enzyme) 오픈 게이트(확정)
- 효소는 초반부터 UI에 노출하지 않는다.
- 아래 연구(또는 업그레이드) 완료 후 “효소 시스템”이 열린다:
  - `발효실험실`(Fermentation Lab) 해금
- 발효실험실 이후:
  - 김치 라인 제품에서 효소 산출이 활성화
  - 연구 비용에 효소가 사용되기 시작
  - UI 상단에 Enzyme 리소스가 표시됨

## 9.4 연구 비용/제출 방식(팩토리오 감성의 최소 적용)
- 연구는 “재고 제출(keep에서 소비)” 방식으로 한다.
- 단, 조작은 복잡하게 만들지 않는다.
- 연구 카드에:
  - 필요 효소량
  - 필요 제품 재고량(예: 배추김치 xN)
  - `[제출]` 버튼
- 제출 시:
  - 요구량만큼 keep_qty에서 차감
  - 요구 조건을 충족하면 연구 완료

> 주의: 생산 재료로 돈을 섞지 않듯, 연구에도 “돈+재고”를 무분별하게 섞지 않는다.
> 초기 Act1 연구는 “효소 + 특정 제품 keep” 중심으로 단순화.

## 9.5 연구로 열리는 기능(예시, 확정 아님)
- 발효실험실(효소 시스템 오픈)
- 물류 고급 옵션:
  - Keep 최소치 설정(초반에는 숨기고 연구로 오픈)
  - 방향 자동 전환(상태 기반)
- 창고(cap) 관련:
  - 제품 cap 증가(보관 기술)
- 생산/판매 품질:
  - 배치량/속도 계수 업그레이드(아이템과 별개로 “기술 버프” 가능)
- 신규 제품 해금:
  - 라인 B(식품) 해금 게이트(예: 김치소스 연구)

> 연구 트리/리스트는 다음 파트에서 “Act1 최소셋”으로 구체화(Part 5에서 진행).

---

> 여기까지가 Part 4 (8~9장).  
> 다음 Part 5에서는 10) 업적/통계, 11) 엔딩/프레스티지(스타김치십), 12) Act 확장 로드맵을 작성한다.


# Kimchi Invasion — Cursor Context MD (v0.56) — Part 5
> 이어서: 목차 10)~12)

---

# 10. 업적/통계/메타 진행(로그, 리플레이 동기)

## 10.1 통계(Stats)의 목적
- 유저에게 “내가 어디에서 병목이 났는지”를 설명한다.
- 프레스티지 반복 플레이에서 성장 체감을 제공한다.
- 디버깅/밸런싱을 위한 내부 지표도 함께 축적한다.

## 10.2 통계 탭 구성(PC 5열/모바일 통계 탭 공통)
### (A) 운영 지표(병목 진단)
- 제품별:
  - 누적 생산량 / 누적 Keep 이동 / 누적 Sell 이동 / 누적 판매량
  - 현재 재고(keep/sell/cap)
  - “CAP_FULL로 멈춘 시간” 누적(병목 탐지)
- 라인별:
  - 생산 속도/배치량
  - 물류 이동속도/방향
  - 판매 속도/판매량

### (B) 재화 지표
- 총 획득 현금
- 누적 효소 획득량
- 누적 AM 획득량
- 프레스티지 횟수

### (C) 업적(Achievements)
- SeoulSurvival 유니폼처럼 업적 그리드 유지
- 업적은 “시스템 학습”을 유도(예: 물류 자동화 첫 도입, CapFull 탈출 등)

### (D) 로그북/패치노트(선택)
- 간단한 런 히스토리(프레스티지 날짜/AM 획득량/최종 매출 등)

## 10.3 업적 설계 원칙
- 단순 누적형 + 시스템 이해형을 섞는다.
- 예시:
  - “첫 판매 달성”
  - “첫 물류 이동”
  - “Sell이 비어 판매 0이 된 상태에서 생산만 1분 유지”(미스매치 학습)
  - “CAP_FULL 상태 3분 이상”(경고형 업적)
  - “물류인력 첫 장착”
  - “배추김치로 효소 1,000 획득”
  - “스타김치십 발사 1회”

---

# 11. 엔딩/프레스티지(서울타워 → 스타김치십 발사) + 외계물질 보상

## 11.1 엔딩 컨셉(확정)
- 서울타워 자체를 발사하지 않는다.
- **서울타워에서 ‘스타김치십(Star Kimchi Ship)’을 발사**한다.
- 발사는 “엔딩이자 프레스티지 트리거”다.

## 11.2 발사 조건(확정)
- “발사조건 1고정”이라는 요구사항을 반영:
  - 발사 조건은 **단일 목표**로 고정한다.
- 단일 목표(구현 친화):
  - (예시) “스타김치십 조립 완료” 또는 “필수 부품 3종 모듈 완성”
- 디테일:
  - 발사 조건의 구체 아이템/수량은 밸런스/Act 확장과 함께 확정한다.
  - 단, 조건은 항상 “복잡한 체크리스트”가 아니라 “단일 Progress Bar”로 보이게 만든다.

## 11.3 발사 진행 UX
- 통계/연구 영역에 “스타김치십 준비도” 카드가 존재:
  - 준비도 % + 필요 재료(요약)
  - `[조립/투입]` 버튼
- 조립/투입은 Keep 재고에서만 소비된다(보호 재고 개념 유지).
- 준비도 100% → `[발사]` 버튼 활성화

## 11.4 프레스티지(리셋) 규칙(확정)
- 발사 시 프레스티지 선택 UI:
  - “계속 플레이(발사만 기록)” 또는 “프레스티지(리셋 + AM 획득)”
- 프레스티지 시 리셋:
  - 현금 0
  - 제품 재고(keep/sell) 0
  - 라인 설치 상태 초기화(기본 라인 1개만)
  - 연구(지구 연구) 초기화 여부는 정책 택1:
    - 추천: “지구 연구는 대부분 초기화, 일부 QoL은 AM 메타로 옮김”
- 유지:
  - AM 메타 업그레이드(프레스티지 보상)만 유지
  - 통계의 ‘누적/최고 기록’은 유지(통계 탭에서 구분 표기)

## 11.5 AM(외계물질) 보상 설계
- AM은 프레스티지 시 지급되는 메타 재화
- 컨셉: “우주에서 가져온 외계물질로 근본적인 버프”
- AM 업그레이드 예시(영구 구조물 X, 메타 버프 O):
  - 기본 배치량 +1
  - 기본 생산속도 +x%
  - 기본 물류 이동 +x%
  - 기본 판매속도 +x%
  - 효소 획득량 +x%
  - 연구 제출 요구량 -x% (QoL)
- AM 업그레이드는 연구 탭의 “AM 연구소” 섹션에서 구매한다.

---

# 12. Act 확장 로드맵(Act1→Act2→Act3) — 유저는 자연스럽게 넘어가게

## 12.1 Act 구분 원칙(확정)
- Act는 내부 개발/기획상의 구분이다.
- 유저는 Act 전환을 “디아블로 Act처럼” 강하게 느끼지 않아야 한다.
- 따라서 전환 방식은:
  - 특정 연구/제품 해금 이후, 자연스럽게 새로운 제품군/시장/서사가 “추가”되는 형태
  - UI 구조(5열/5탭)는 유지
  - 기존 라인은 계속 의미를 가진다(특히 김치라인은 효소 때문에 유지 필요)

## 12.2 Act1: 한국 내 김치 성공기(현재 범위)
- 김치 라인 + 식품 라인 운영
- 효소 오픈(발효실험실)
- 스타김치십 발사의 “초기 빌드업” 마련

## 12.3 Act2: 글로벌(김치로 세계 식품산업 제패)
- 핵심 변화는 “수요 레버 확장”:
  - 시장 단계가 해외로 확장(해외 유통/현지 파트너/글로벌 채널)
  - 판매조직이 해외지사/글로벌 본부로 확장
- 제품 확장:
  - “세계 음식 × 김치”의 확장(이미 식품 라인에 일부 반영)
- 밸런스 원칙:
  - 글로벌로 갈수록 “판매속도”는 커지지만,
  - Keep을 모아 연구/발사 재료를 제출하는 압박도 함께 커져야 한다.

## 12.4 Act3: 우주(식품산업은 좁다. 우주로)
- 핵심 변화는 “미래산업/우주선 재료” 제품군의 추가
- 설계 원칙(이해 쉬운 빌드업):
  - 신소재 원료 → 배터리 → 반도체 → GPU → (최종: 우주선 필수 모듈/부품)
- 중요한 운영 규칙(기획 의도):
  - 미래산업 제품들은 “판매도 가능”하고,
  - “우주선 발사 재료로도 사용”하며,
  - “추가로 생산설비/자동화 강화 재료로도 사용”된다.
  - 단, 이 ‘추가 기능’은 기존 루프를 깨지 않게 “더하기(옵션)”로 제공한다.

> Act3의 구체 제품/레시피/단가/모듈 3종 세부는 밸런스 파트에서 확정한다.
> 지금은 “로드맵 원칙”만 고정.

---

> 여기까지가 Part 5 (10~12장).  
> 다음 Part 6에서는 13) 데이터 모델/상태머신/저장 포맷(구현 가이드)와
> 14) 구현 체크리스트/테스트 포인트를 작성하고 문서를 완결한다.


# Kimchi Invasion — Cursor Context MD (v0.56) — Part 6 (Final)
> 이어서: 목차 13)~14) + 구현 전 질문(가정 금지 원칙)

---

# 13. 데이터 모델/상태머신/저장 포맷(구현 가이드)

## 13.1 구현 아키텍처 원칙
- 단일 페이지(PC 5열, 모바일 5탭) 레이아웃을 중심으로 컴포넌트 재사용
- “라인(Line)”이 핵심 도메인 객체
- 모든 상태는 저장/복원 가능해야 함(브라우저 로컬 저장 우선)
- Tick 기반 시뮬레이션(예: 100ms~500ms)로 자동 생산/물류/판매 처리

## 13.2 핵심 엔티티(추천 타입)
### 13.2.1 Product
- id, name, category(김치/식품/미래)
- price(고정 단가)
- cap_base(기본 cap)
- enzyme_yield_base(효소 산출 기본, 김치류만 >0)
- recipe_inputs: [{product_id, qty}]  (팩토리오식 의존성)

### 13.2.2 Line
- id (1..N)
- assigned_product_id (nullable)
- slots:
  - equipment_item_id (nullable)
  - worker_item_id (nullable)
  - logistics_item_id (nullable)
  - market_item_id (nullable)
  - salesorg_item_id (nullable)
  - salesstaff_item_id (nullable)
- logistics_direction: KEEP_PRIORITY | SELL_PRIORITY
- ui_state(접힘/펼침 등, 선택)

### 13.2.3 ProductInventory (제품별 재고)
- product_id
- keep_qty
- sell_qty
- cap (cap_base + 연구/버프/아이템 효과 반영 결과)

### 13.2.4 Item (아이템 정의)
- item_id, type(slot_type), tier
- name, cost_cash
- refund_cash (또는 refund_rate)
- modifiers:
  - +batch
  - +prod_speed
  - +move_speed
  - +sell_speed
  - +sell_amount
  - +auto_sell_clicks
  - 기타(향후)

### 13.2.5 ItemInventory (아이템 재고)
- item_id -> count

### 13.2.6 Research
- research_id, name, status(locked/available/done)
- cost_enzyme
- cost_products_keep: [{product_id, qty}]
- effects: (효소 오픈, 신규 제품 해금, cap 증가, QoL 등)

### 13.2.7 Meta(프레스티지/AM)
- prestige_count
- alien_matter (AM)
- meta_upgrades: {upgrade_id -> level}

### 13.2.8 Currency
- cash
- enzyme
- alien_matter (또는 meta에 포함)

## 13.3 시뮬레이션(틱) 처리 순서(권장)
매 tick마다 아래 순서로 처리:
1) 자동 생산(라인별)
2) 자동 물류 이동(라인별)
3) 자동 판매(라인별)
4) 리소스/통계 누적 업데이트
5) UI 렌더

> 왜 이 순서인가:
> 생산→물류→판매 흐름을 그대로 반영해 디버깅이 쉽다.

## 13.4 클릭 액션(초반 클리커)
- produce_click(line_id):
  - cap 체크 후 생산(배치량 반영)
- logistics_click(line_id, target: KEEP|SELL):
  - keep↔sell 1개(또는 click_amount) 이동
- sell_click(line_id):
  - sell_qty에서 sell_amount만큼 판매(가능한 만큼) → cash 증가

## 13.5 자동화 처리(라인별)
각 라인에 대해 effective 값을 계산:
- batch = base + equipment_mod
- prod_speed = base + worker_mod
- move_speed = base + logistics_mod
- sell_speed = base + market_mod
- sell_amount = base + salesorg_mod
- auto_sell_clicks = base + salesstaff_mod (선택)

자동 생산:
- prod_speed에 따라 누적 시간(accumulator)로 생산 이벤트 발생
- 생산은 cap을 넘지 않도록 제한

자동 물류:
- move_speed에 따라 keep↔sell 이동
- 방향에 따라 이동 우선순위 결정
- (구현 단순화) 생산 직후 분류 정책은 14.3 질문에서 확정 필요

자동 판매:
- sell_speed에 따라 판매 이벤트 발생
- 각 이벤트에서 sell_amount만큼 판매(가능한 만큼)

## 13.6 저장/로드 포맷(권장 JSON)
- localStorage key: `kimchi_invasion_save_v1`
- 포함:
  - currencies, meta
  - lines[]
  - product_inventories[]
  - item_inventory
  - research_state
  - stats/achievements
  - version, timestamp

버전 정책:
- `save_version` 필드로 마이그레이션 가능하게

---

# 14. 구현 체크리스트(스프린트 단위) + 테스트 포인트

## 14.1 Sprint 1 — “클리커 MVP(완전 수동)”
- [ ] Product 데이터(배추김치 1개만)
- [ ] Line 1개(배추김치 고정)
- [ ] 재고(keep/sell/cap) 표시
- [ ] 생산 클릭 → 재고 증가(cap 제한)
- [ ] 물류 클릭(keep/sell 이동)
- [ ] 판매 클릭(sell 소비, cash 증가)
- [ ] PC 5열 레이아웃(기본)
- [ ] 모바일 5탭 레이아웃(기본)
테스트:
- cap 도달 시 생산이 멈추는지
- sell 0에서 판매 불가 처리

## 14.2 Sprint 2 — “아이템(자산) 슬롯 + 인컨텍스트 구매/장착/판매”
- [ ] Item 정의 1~2개(설비/작업인력)
- [ ] 슬롯 UI(ProdCard)
- [ ] 슬롯 클릭 팝오버/바텀시트로 구매/장착/판매
- [ ] 장착 시 효과 반영(batch/prod_speed)
- [ ] 라인 철거/변경 시 장착 아이템 회수(재고로)
테스트:
- 장착/해제 시 수량(count)이 정확히 변하는지
- 판매(환급) 금액 반영

## 14.3 Sprint 3 — “자동 생산/물류/판매 + 병목 시그널”
- [ ] Tick 시스템 도입
- [ ] 자동 생산(prod_speed)
- [ ] 물류인력(move_speed) + 방향 토글
- [ ] 시장/조직 기반 자동 판매(sell_speed/sell_amount)
- [ ] 상태 뱃지(CAP_FULL/SELL_EMPTY 등)
테스트:
- sell_speed가 과하면 keep이 모이지 않는 미스매치가 발생하는지
- cap_full로 생산 중단이 명확히 보이는지

## 14.4 Sprint 4 — “연구(발효실험실) + 효소 오픈”
- [ ] 연구 탭(PC 4열, 모바일 연구탭)
- [ ] 발효실험실 연구: 완료 후 enzyme 리소스 표시
- [ ] 김치류 제품 효소 산출 활성화
- [ ] 연구 제출(keep 소비 + enzyme 소비)
테스트:
- 연구 제출 시 keep가 정확히 차감되는지
- 발효실험실 전/후 UI 노출 차이가 올바른지

## 14.5 Sprint 5 — “제품/레시피 확장(김치 5, 식품 5) + 라인 추가”
- [ ] 제품 10개 추가
- [ ] 레시피 의존성 적용(상위 제품 생산 시 keep 소비)
- [ ] 라인 설치/할당/철거
- [ ] 라인별 3카드(생산/물류/판매) 대응 유지
테스트:
- 레시피 부족 시 생산 불가 처리(명확한 안내)
- 라인 정렬(3열에서 동일 행 유지)

## 14.6 Sprint 6 — “엔딩/프레스티지(스타김치십) + AM”
- [ ] 발사 조건(단일 목표) 카드
- [ ] 조립/투입(keep 소비) → 준비도%
- [ ] 발사 → 프레스티지 선택
- [ ] AM 지급/메타 업그레이드
테스트:
- 프레스티지 리셋 범위가 설계대로인지
- AM 업그레이드가 다음 런에 반영되는지

---

# 15. 구현 전 ‘확정 질문’(가정 금지 원칙에 따른 필수 확인)
아래는 구현자가 임의로 가정하면 게임성이 바뀌므로, 구현 전에 반드시 기획자에게 확인한다.

## Q1) 생산 직후 기본 분류는?
- 옵션 A: 생산된 수량은 기본적으로 Keep에 들어간다(추천)
- 옵션 B: 생산된 수량은 기본적으로 Sell에 들어간다
- 옵션 C: 생산된 수량은 “미분류 버퍼”에 들어가고 물류가 분배한다(복잡도↑)

## Q2) cap 초과 생산 처리
- 옵션 A: 초과분은 생산 실패(0개 생산)
- 옵션 B: cap 남은 만큼만 부분 생산

## Q3) 레시피 소비 위치
- 옵션 A: 상위 제품 생산 시, 요구 재료는 keep에서만 소비(추천)
- 옵션 B: keep+sell 합산에서 소비

## Q4) 라인 철거 환급
- 옵션 A: 설치비 0% 환급(가혹하지만 명확)
- 옵션 B: 설치비 일부 환급(예: 50%)

---

> 문서 끝.  
> 이 MD를 Cursor 컨텍스트로 넣고, Sprint 1부터 구현을 진행한다.
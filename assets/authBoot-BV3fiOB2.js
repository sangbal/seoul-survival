import{createClient as se}from"https://esm.sh/@supabase/supabase-js@2.49.1";const J={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52eGR3YWNxbWlvZnBlbm51a2VvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTMwNDYsImV4cCI6MjA4MTQ2OTA0Nn0.v2UoOk7xdmascY10Oy8fT3kYTWm9gWKSC9C4wH4nwP4",VITE_SUPABASE_URL:"https://nvxdwacqmiofpennukeo.supabase.co"},U=typeof import.meta<"u"&&J?J:{};try{console.log("[env] VITE_SUPABASE_URL:",U.VITE_SUPABASE_URL),console.log("[env] VITE_SUPABASE_ANON_KEY length:",(U.VITE_SUPABASE_ANON_KEY||"").length)}catch{}const w=U.VITE_SUPABASE_URL??"",S=U.VITE_SUPABASE_ANON_KEY??"",oe="clicksurvivor-auth";function ne(){const e=typeof w=="string"&&typeof S=="string"&&w.startsWith("https://")&&w.length>8&&S.length>0;if(!e)try{console.warn("[auth] Supabase not configured",{urlEmpty:!w,anonEmpty:!S,urlValue:w||"(empty)",anonLen:(S||"").length})}catch{}return e}const R="__clicksurvivor_supabase_client";function b(){if(!ne())return null;if(typeof globalThis<"u"&&globalThis[R])return globalThis[R];const e=se(w,S,{auth:{storageKey:oe,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});return typeof globalThis<"u"&&(globalThis[R]=e),e}let B=null;function A(){return B||(B=b(),B)}function O(){return ne()}async function ae(){const e=A();if(!e)return{ok:!1,reason:"not_configured"};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:r}=await e.auth.exchangeCodeForSession(location.href);if(r)return{ok:!1,reason:"exchange_failed",error:r};const s=new URL(location.href);return s.searchParams.delete("code"),s.searchParams.delete("state"),history.replaceState(null,"",s.toString()),{ok:!0,exchanged:!0}}catch(r){return{ok:!1,reason:"exchange_failed",error:r}}}async function N(){const e=A();if(!e)return null;const{data:n}=await e.auth.getUser();return(n==null?void 0:n.user)||null}async function ce(e){const n=A();if(!n)return{ok:!1,reason:"not_configured"};const r=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"),{error:s}=await n.auth.signInWithOAuth({provider:e,options:{redirectTo:r}});return s?{ok:!1,reason:"oauth_failed",error:s}:{ok:!0}}async function ie(){const e=A();if(!e)return{ok:!1,reason:"not_configured"};const{error:n}=await e.auth.signOut();return n?{ok:!1,reason:"signout_failed",error:n}:{ok:!0}}function le(e){const n=A();if(!n)return()=>{};const{data:r}=n.auth.onAuthStateChange((s,a)=>{e((a==null?void 0:a.user)||null)});return()=>r.subscription.unsubscribe()}async function ue(){const e=b();if(!e)return{ok:!1,reason:"not_configured"};const n=await N();if(!n)return{ok:!1,reason:"not_signed_in"};try{const{error:r}=await e.from("game_saves").delete().eq("user_id",n.id);if(r)return console.error("Failed to delete game_saves:",r),{ok:!1,reason:"delete_saves_failed",error:r};const{error:s}=await e.from("leaderboard").delete().eq("user_id",n.id);return s?(console.error("Failed to delete leaderboard:",s),{ok:!1,reason:"delete_leaderboard_failed",error:s}):{ok:!0}}catch(r){return console.error("Exception while deleting user data:",r),{ok:!1,reason:"exception",error:r}}}const T="seoulsurvival";var ee,te;const y=!!((te=(ee=import.meta)==null?void 0:ee.env)!=null&&te.DEV);function C(e){if(!e||typeof e!="string")return{raw:"",key:""};const r=e.trim().normalize("NFC"),s=r.toLowerCase();return{raw:r,key:s}}function Se(e){const{raw:n,key:r}=C(e);return!n||n.length===0?{ok:!1,reasonKey:"empty"}:n.length<1?{ok:!1,reasonKey:"tooShort"}:n.length>6?{ok:!1,reasonKey:"tooLong"}:/^[가-힣a-zA-Z0-9_]+$/.test(n)?de(n,r)?{ok:!1,reasonKey:"banned"}:{ok:!0}:{ok:!1,reasonKey:"invalid"}}function de(e,n){const r=["시발","좆","개새끼","병신","미친","지랄","닥쳐","엿","좆까","fuck","shit","bitch","asshole","damn","crap","piss","멍청이","바보","등신","호구","admin","administrator","root","system","null","undefined"],s=e.toLowerCase(),a=n.toLowerCase();for(const c of r)if(a.includes(c.toLowerCase())||s.includes(c.toLowerCase()))return!0;return!1}async function Ae(e,n){var c;const r=b();if(!r)return{success:!1,error:"network",message:"Supabase not configured"};const{raw:s,key:a}=C(e);if(!a)return{success:!1,error:"unknown",message:"Invalid nickname"};try{const{data:t,error:o}=await r.rpc("claim_nickname",{p_game_slug:T,p_nickname_key:a,p_nickname_raw:s,p_user_id:n});return o?o.code==="PGRST116"||(c=o.message)!=null&&c.includes("does not exist")?(y&&console.warn("[LB] nickname_registry table not found, run supabase/nickname_registry.sql"),{success:!1,error:"network",message:"Nickname registry not configured"}):(console.error("Claim nickname error:",o),{success:!1,error:"network",message:o.message}):t&&typeof t=="object"?t.success?{success:!0,message:t.message||"Nickname claimed"}:{success:!1,error:t.error||"unknown",message:t.message||"Failed to claim nickname"}:{success:!1,error:"unknown",message:"Unexpected response format"}}catch(t){return console.error("Claim nickname exception:",t),{success:!1,error:"network",message:t.message||"Network error"}}}async function fe(e,n=T){var s;const r=b();if(!r)return{success:!1,error:"network",message:"Supabase not configured"};if(!e)return{success:!1,error:"unknown",message:"User ID required"};try{const{data:a,error:c}=await r.rpc("release_nickname",{p_game_slug:n,p_user_id:e});return c?c.code==="PGRST116"||(s=c.message)!=null&&s.includes("does not exist")?(y&&console.warn("[LB] release_nickname RPC not found, nickname_registry may not be set up"),{success:!1,error:"network",message:"Nickname registry not configured"}):(console.error("Release nickname error:",c),{success:!1,error:"network",message:c.message}):a&&typeof a=="object"?a.success?(y&&console.log("[LB] Nickname released:",a.released_key||"none"),{success:!0,message:a.message||"Nickname released"}):{success:!1,error:a.error||"unknown",message:a.message||"Failed to release nickname"}:{success:!1,error:"unknown",message:"Unexpected response format"}}catch(a){return console.error("Release nickname exception:",a),{success:!1,error:"network",message:a.message||"Network error"}}}function x(e,n="unknown"){if(e==null)return y&&console.warn(`[LB] ${n} is null/undefined, using 0`),0;const r=typeof e=="string"?parseFloat(e):Number(e);if(!Number.isFinite(r))return y&&console.warn(`[LB] ${n} is not finite (${e}), using 0`),0;const s=Math.floor(r),a=Math.max(0,s);if(y){const c=r!==s&&Number.isFinite(r),t=r<0;if(c||t){const o=[];c&&o.push("was decimal"),t&&o.push("was negative"),console.debug(`[LB] ${n} converted from ${r} to ${a} (${o.join(", ")})`)}}return a}let Z=0,Q="",I=0;const me=5e3;let E=null,D=0,P=!1;const ge=15e3,_e=0;function X(e,n=""){const r=Date.now(),s=(e==null?void 0:e.message)||String(e);if(s===Q&&r-Z<me){I++;return}I>0?(console.error(`[LB] Leaderboard error (repeated ${I} times):`,e,n),I=0):console.error("[LB] Leaderboard error:",e,n),Z=r,Q=s}async function Te(e,n,r,s=0,a=!1){try{const c=await N();if(!c)return y&&console.log("Leaderboard: User not logged in, skipping update"),{success:!1,error:"Not logged in"};const t=x(n,"total_assets"),o=x(r,"play_time_ms"),i=x(s,"tower_count"),l={nickname:C(e||"익명"),total_assets:t,play_time_ms:o,tower_count:i};if(E&&E.nickname===l.nickname&&E.total_assets===l.total_assets&&E.play_time_ms===l.play_time_ms&&E.tower_count===l.tower_count)return y&&console.debug("[LB] Skipping update: payload unchanged"),{success:!0,data:null,skipped:!0};const m=Date.now(),u=a?_e:ge;if(!a&&P&&m-D<u)return y&&console.debug(`[LB] Throttled: ${Math.round((u-(m-D))/1e3)}s remaining`),{success:!0,data:null,skipped:!0,throttled:!0};y&&console.debug("[LB] updateLeaderboard payload:",{nickname:e,totalAssets:{raw:n,safe:t,type:typeof n},playTimeMs:{raw:r,safe:o,type:typeof r},towerCount:{raw:s,safe:i,type:typeof s},forceImmediate:a});const g=b();if(!g)return{success:!1,error:"Supabase client not available"};const{data:_,error:h}=await g.from("leaderboard").upsert({user_id:c.id,game_slug:T,nickname:e||"익명",total_assets:t,play_time_ms:o,tower_count:i,updated_at:new Date().toISOString()},{onConflict:"user_id,game_slug"}).select().single();return h?(X(h,{nickname:e,safeTotalAssets:t,safePlayTimeMs:o,safeTowerCount:i}),{success:!1,error:h.message}):(E=l,D=m,P=!0,y&&console.debug("[LB] Leaderboard updated successfully:",_),{success:!0,data:_})}catch(c){return X(c,"exception"),D=Date.now(),P=!1,{success:!1,error:c.message}}}async function ve(e=10,n="assets"){var r,s,a,c,t,o;try{const i=b();if(!i)return console.error("Leaderboard: Supabase client not configured"),console.warn("[LB] fetch failed",{reason:"not_configured",phase:"init"}),{success:!1,error:"Supabase가 설정되지 않았습니다. shared/auth/config.js를 확인해주세요.",data:[],errorType:"config"};let l=i.from("leaderboard").select("nickname, total_assets, play_time_ms, tower_count, updated_at").eq("game_slug",T).limit(e);n==="assets"?l=l.order("tower_count",{ascending:!1}).order("total_assets",{ascending:!1}):n==="playtime"&&(l=l.order("play_time_ms",{ascending:!1}));const{data:m,error:u}=await l;if(u){console.error("Leaderboard fetch error:",u);const g=u.status??u.code??null,_=u.code==="PGRST116"||((r=u.message)==null?void 0:r.includes("relation"))||((s=u.message)==null?void 0:s.includes("does not exist")),h=g===401||g===403||((c=(a=u.message)==null?void 0:a.toLowerCase)==null?void 0:c.call(a).includes("permission denied"))||((o=(t=u.message)==null?void 0:t.toLowerCase)==null?void 0:o.call(t).includes("rls"));return console.warn("[LB] fetch failed",{phase:"select",status:g,code:u.code,message:u.message,details:u.details,hint:u.hint}),_?{success:!1,error:"리더보드 테이블이 없습니다. Supabase SQL Editor에서 supabase/leaderboard.sql을 실행해주세요.",data:[],errorType:"schema",status:g}:h?{success:!1,error:"권한이 없어 리더보드를 불러올 수 없습니다.",data:[],errorType:"forbidden",status:g}:{success:!1,error:u.message,data:[],errorType:"generic",status:g}}return{success:!0,data:m||[]}}catch(i){return console.error("Leaderboard fetch exception:",i),console.warn("[LB] fetch failed",{phase:"exception",message:i==null?void 0:i.message,error:i}),{success:!1,error:i.message||"알 수 없는 오류",data:[],errorType:"network"}}}async function Be(e,n="assets"){const r=b();if(!r)return console.warn("[LB] my_rank failed",{reason:"not_configured"}),{success:!1,data:null,errorType:"config"};const a=C(e).toLowerCase();if(!a)return{success:!1,data:null,errorType:"no_nickname"};try{const{data:c,error:t,status:o}=await r.rpc("get_my_rank",{p_game_slug:T,p_nickname:a,p_sort_by:n});if(t){console.error("My rank RPC error:",t),console.warn("[LB] my_rank failed",{phase:"rpc",status:o??t.status,code:t.code,message:t.message,details:t.details,hint:t.hint});const l=o===401||o===403?"forbidden":"generic";return{success:!1,data:null,error:t.message,errorType:l,status:o??t.status}}const i=Array.isArray(c)?c[0]:c;return i?{success:!0,data:{rank:i.rank,nickname:i.nickname,total_assets:i.total_assets,play_time_ms:i.play_time_ms,tower_count:i.tower_count||0}}:{success:!1,data:null,errorType:"not_found"}}catch(c){return console.error("My rank RPC exception:",c),console.warn("[LB] my_rank failed",{phase:"exception",message:c==null?void 0:c.message,error:c}),{success:!1,data:null,error:c.message||"알 수 없는 오류",errorType:"network"}}}async function he(){const e=b();if(!e)return{ok:!1,status:"NOT_CONFIGURED",reason:"not_configured"};const n=await N();if(!n)return{ok:!1,status:"AUTH_FAILED",reason:"not_signed_in"};try{const t=await fe(n.id,"seoulsurvival");t.success?console.log("[DeleteAccount] Nickname released successfully"):console.warn("[DeleteAccount] Nickname release failed:",t.message)}catch(t){console.warn("[DeleteAccount] Nickname release exception:",t)}const{data:{session:r},error:s}=await e.auth.getSession();if(s||!(r!=null&&r.access_token))return{ok:!1,status:"AUTH_FAILED",reason:"no_session",error:s};const a=r.access_token,c=`${w}/functions/v1/delete-account`;try{const t=new AbortController,o=setTimeout(()=>t.abort(),3e4),i=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},signal:t.signal});if(clearTimeout(o),!i.ok){let m;try{m=await i.json()}catch{m={status:"UNKNOWN_ERROR",message:`HTTP ${i.status}`}}return{ok:!1,status:m.status||"UNKNOWN_ERROR",reason:m.message||`HTTP ${i.status}`,error:m,httpStatus:i.status}}const l=await i.json();return l.status==="ALL_SUCCESS"?{ok:!0,status:"ALL_SUCCESS"}:l.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?{ok:!1,status:"DATA_DELETED_BUT_AUTH_DELETE_FAILED",reason:"Data deleted but account deletion failed"}:{ok:!1,status:l.status||"UNKNOWN_ERROR",reason:l.message||"Unknown error"}}catch(t){return t.name==="AbortError"?{ok:!1,status:"UNKNOWN_ERROR",reason:"timeout",error:t}:(console.error("Delete account exception:",t),{ok:!1,status:"UNKNOWN_ERROR",reason:"network_error",error:t})}}function ye(e){var n,r,s,a;return e?((n=e.user_metadata)==null?void 0:n.full_name)||((r=e.user_metadata)==null?void 0:r.name)||((s=e.user_metadata)==null?void 0:s.preferred_username)||e.email||((a=e.id)==null?void 0:a.slice(0,8)):null}function pe(e){return e&&e.email||null}async function ke(e){const{scope:n="hub",providerButtons:r=[],defaultProvider:s="google",loginBtn:a,logoutBtn:c,userLabel:t,statusLabel:o,toast:i}=e||{},l=typeof i=="function"?i:()=>{};await ae();function m(d){const f=ye(d);if(t&&(t.textContent=f||(n==="hub"?"Guest":"게스트"),t.hidden=!1,t.setAttribute("aria-hidden","false")),o&&(O()?f?(o.textContent=n==="hub"?"Signed in":"로그인됨",o.style.color="rgba(52, 211, 153, .95)"):(o.textContent=n==="hub"?"Not signed in":"로그인 안 됨",o.style.color="rgba(148, 163, 184, .95)"):(o.textContent=n==="hub"?"Guest mode (로그인 준비 중)":"게스트 모드 (로그인 준비 중)",o.style.color="rgba(148, 163, 184, .95)")),a){const p=!!f;a.hidden=p,a.setAttribute("aria-hidden",p?"true":"false"),a.setAttribute("tabindex",p?"-1":"0")}if(c){const p=!!f;c.hidden=!p,c.setAttribute("aria-hidden",p?"false":"true"),c.setAttribute("tabindex",p?"0":"-1")}const L=document.getElementById("authProviderButtons");L&&(L.style.display=f?"none":"flex");const v=document.getElementById("accountGuestInfo");v&&(v.style.display=f?"none":"block");const K=document.getElementById("accountLoggedInInfo");K&&(K.style.display=f?"block":"none");const V=document.getElementById("accountOverviewSection");V&&(V.style.display=f?"block":"none");const G=document.getElementById("preferencesSection");G&&(G.style.display="block");const W=document.getElementById("privacyDataSection");W&&(W.style.display=f?"block":"none");const H=document.getElementById("dangerZoneSection");H&&(H.style.display=f?"block":"none");const Y=document.getElementById("authUserInfo");if(Y){Y.style.display=f?"block":"none";const p=document.getElementById("authUserEmail");if(p){const re=pe(d);p.textContent=re||"(이메일 없음)"}const q=document.getElementById("authUserName");q&&(q.textContent=f||"Guest")}const j=document.getElementById("cloudSaveSection");j&&(j.style.display=f?"block":"none");const z=document.getElementById("guestSaveInfo");z&&(z.style.display=f?"none":"block")}const u=await N();m(u);const g=le(d=>m(d));async function _(d){if(!O()){l("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}l(n==="hub"?"Redirecting…":"이동 중…"),(await ce(d)).ok||l(n==="hub"?"Login failed":"로그인 실패")}async function h(){if(!O())return;(await ie()).ok?l(n==="hub"?"Signed out":"로그아웃"):l(n==="hub"?"Logout failed":"로그아웃 실패")}a&&a.addEventListener("click",d=>{d.preventDefault(),_(s)}),r.forEach(d=>{var L;const f=(L=d==null?void 0:d.dataset)==null?void 0:L.authProvider;f&&d.addEventListener("click",v=>{v.preventDefault(),_(f)})}),c&&c.addEventListener("click",d=>{d.preventDefault(),h()});const F=document.getElementById("deleteDataBtn");F&&F.addEventListener("click",async d=>{d.preventDefault(),await be(n,l,h)});const M=document.getElementById("deleteAccountBtn");return M&&M.addEventListener("click",async d=>{d.preventDefault(),await we(n,l,h)}),{off:g}}async function be(e,n,r){var o,i,l,m;const s=typeof n=="function"?n:()=>{};if(!confirm(`모든 클라우드 데이터(저장, 리더보드)와 로컬 게임 저장을 삭제하시겠습니까?

⚠️ 이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 삭제하시겠습니까?

삭제될 데이터:
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.`))return;s(e==="hub"?"Deleting data…":"데이터 삭제 중…");let t;try{t=await ue()}catch(u){console.error("Delete user data exception:",u),s("데이터 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!t.ok){let u;if(t.reason==="not_configured")u="데이터 삭제 기능이 설정되지 않았습니다.";else if(t.reason==="not_signed_in")u="로그인 상태가 아닙니다. 다시 로그인해주세요.";else if(t.reason==="delete_saves_failed"||t.reason==="delete_leaderboard_failed"){const g=((o=t.error)==null?void 0:o.code)||((i=t.error)==null?void 0:i.status)||"";g===401||g===403?u="권한이 없습니다. 다시 로그인해주세요.":u=e==="hub"?`데이터 삭제 실패: ${t.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`:`데이터 삭제 실패: ${t.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`}else u=e==="hub"?`데이터 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`데이터 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`;s(u),console.error("Delete user data failed:",t),(t.reason==="not_signed_in"||((l=t.error)==null?void 0:l.code)===401||((m=t.error)==null?void 0:m.code)===403)&&setTimeout(()=>{confirm("로그아웃하시겠습니까?")&&r()},1e3);return}try{const u=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(_=>{_.startsWith("clicksurvivor-")&&_!=="clicksurvivor_lang"&&u.push(_)}),u.forEach(_=>{try{localStorage.removeItem(_)}catch(h){console.warn(`Failed to remove localStorage key "${_}":`,h)}})}catch(u){console.warn("Failed to clear localStorage:",u)}s(e==="hub"?"Data deleted. Signing out…":"데이터가 삭제되었습니다. 로그아웃 중…"),await r(),setTimeout(()=>{window.location.reload()},500)}async function we(e,n,r){const s=typeof n=="function"?n:()=>{};if(!confirm(`계정과 모든 데이터를 영구적으로 삭제하시겠습니까?

⚠️ 삭제될 내용:
• 계정 정보 (이메일, 로그인 정보)
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 계정을 삭제하시겠습니까?

이 작업은 다음을 포함합니다:
• 계정 정보 완전 삭제
• 모든 클라우드 데이터 삭제
• 모든 로컬 게임 저장 삭제

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.

이 작업은 되돌릴 수 없습니다.`))return;s(e==="hub"?"Deleting account…":"계정 삭제 중…");let t;try{t=await he()}catch(o){console.error("Delete account exception:",o),s("계정 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!t.ok){let o;t.status==="NOT_CONFIGURED"?o="계정 삭제 기능이 설정되지 않았습니다. 고객지원에 문의해주세요.":t.status==="AUTH_FAILED"?o="로그인 상태가 만료되었습니다. 다시 로그인해주세요.":t.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?o="데이터는 삭제되었지만 계정 삭제에 실패했습니다. 고객지원에 문의해주세요.":t.reason==="timeout"?o="요청 시간이 초과되었습니다. 네트워크 연결을 확인하고 다시 시도해주세요.":t.reason==="network_error"?o="네트워크 오류가 발생했습니다. 연결을 확인하고 다시 시도해주세요.":t.httpStatus===404?o="계정 삭제 기능이 아직 준비되지 않았습니다. 고객지원에 문의해주세요.":o=e==="hub"?`계정 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`계정 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`,s(o),console.error("Delete account failed:",t);return}try{const o=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(l=>{l.startsWith("clicksurvivor-")&&l!=="clicksurvivor_lang"&&o.push(l)}),o.forEach(l=>{try{localStorage.removeItem(l)}catch(m){console.warn(`Failed to remove localStorage key "${l}":`,m)}})}catch(o){console.warn("Failed to clear localStorage:",o)}s(e==="hub"?"Account deleted. Signing out…":"계정이 삭제되었습니다. 로그아웃 중…");try{await r()}catch(o){console.warn("Logout after account deletion failed (expected):",o)}setTimeout(()=>{window.location.reload()},1e3)}function k(e){return document.querySelector(e)}function $(e){const n=k("#toast");n&&(n.textContent=e,n.classList.add("show"),window.clearTimeout($._t),$._t=window.setTimeout(()=>n.classList.remove("show"),1400))}function Ee(){return location.pathname.includes("/seoulsurvival/")?"game":"hub"}window.addEventListener("DOMContentLoaded",async()=>{const e=k("#loginBtn")||k("#authLoginBtn"),n=k("#logoutBtn")||k("#authLogoutBtn"),r=k("#authUserLabel"),s=k("#authStatusLabel"),a=Array.from(document.querySelectorAll("[data-auth-provider]")),c=k("#drawerAuthLoginBtn"),t=k("#drawerAuthLogoutBtn"),o=k("#drawerAuthUserLabel");if(!(!e&&!c&&a.length===0))try{await Promise.race([ke({scope:Ee(),providerButtons:a,defaultProvider:"google",loginBtn:e||c,logoutBtn:n||t,userLabel:r||o,statusLabel:s,toast:$}),new Promise((i,l)=>setTimeout(()=>l(new Error("Auth init timeout")),2e3))])}catch(i){console.warn("[authBoot] Auth initialization failed or timed out, using guest mode:",i)}});export{N as a,ne as b,Ae as c,ve as d,Be as e,ke as f,b as g,ie as h,O as i,C as n,le as o,ce as s,Te as u,Se as v};

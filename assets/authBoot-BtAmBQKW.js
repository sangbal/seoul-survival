import{createClient as C}from"https://esm.sh/@supabase/supabase-js@2.49.1";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const U={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52eGR3YWNxbWlvZnBlbm51a2VvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTMwNDYsImV4cCI6MjA4MTQ2OTA0Nn0.v2UoOk7xdmascY10Oy8fT3kYTWm9gWKSC9C4wH4nwP4",VITE_SUPABASE_URL:"https://nvxdwacqmiofpennukeo.supabase.co"},S=typeof import.meta<"u"&&U?U:{};try{console.log("[env] VITE_SUPABASE_URL:",S.VITE_SUPABASE_URL),console.log("[env] VITE_SUPABASE_ANON_KEY length:",(S.VITE_SUPABASE_ANON_KEY||"").length)}catch{}const f=S.VITE_SUPABASE_URL??"",g=S.VITE_SUPABASE_ANON_KEY??"",N="clicksurvivor-auth";function O(){const t=typeof f=="string"&&typeof g=="string"&&f.startsWith("https://")&&f.length>8&&g.length>0;if(!t)try{console.warn("[auth] Supabase not configured",{urlEmpty:!f,anonEmpty:!g,urlValue:f||"(empty)",anonLen:(g||"").length})}catch{}return t}function T(){return O()?C(f,g,{auth:{storageKey:N,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}):null}let y=null;function p(){return y||(y=T(),y)}function _(){return O()}async function x(){const t=p();if(!t)return{ok:!1,reason:"not_configured"};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:o}=await t.auth.exchangeCodeForSession(location.href);if(o)return{ok:!1,reason:"exchange_failed",error:o};const r=new URL(location.href);return r.searchParams.delete("code"),r.searchParams.delete("state"),history.replaceState(null,"",r.toString()),{ok:!0,exchanged:!0}}catch(o){return{ok:!1,reason:"exchange_failed",error:o}}}async function R(){const t=p();if(!t)return null;const{data:e}=await t.auth.getUser();return(e==null?void 0:e.user)||null}async function V(t){const e=p();if(!e)return{ok:!1,reason:"not_configured"};const o=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"),{error:r}=await e.auth.signInWithOAuth({provider:t,options:{redirectTo:o}});return r?{ok:!1,reason:"oauth_failed",error:r}:{ok:!0}}async function Y(){const t=p();if(!t)return{ok:!1,reason:"not_configured"};const{error:e}=await t.auth.signOut();return e?{ok:!1,reason:"signout_failed",error:e}:{ok:!0}}function D(t){const e=p();if(!e)return()=>{};const{data:o}=e.auth.onAuthStateChange((r,n)=>{t((n==null?void 0:n.user)||null)});return()=>o.subscription.unsubscribe()}function K(t){var e,o,r,n;return t?((e=t.user_metadata)==null?void 0:e.full_name)||((o=t.user_metadata)==null?void 0:o.name)||((r=t.user_metadata)==null?void 0:r.preferred_username)||t.email||((n=t.id)==null?void 0:n.slice(0,8)):null}async function J(t){const{scope:e="hub",providerButtons:o=[],defaultProvider:r="google",loginBtn:n,logoutBtn:i,userLabel:u,statusLabel:c,toast:A}=t||{},d=typeof A=="function"?A:()=>{};await x();function b(a){const s=K(a);u&&(u.textContent=s||(e==="hub"?"Guest":"게스트"),u.hidden=!1),c&&(_()?s?(c.textContent=e==="hub"?"Signed in":"로그인됨",c.style.color="rgba(52, 211, 153, .95)"):(c.textContent=e==="hub"?"Not signed in":"로그인 안 됨",c.style.color="rgba(148, 163, 184, .95)"):(c.textContent=e==="hub"?"Guest mode (로그인 준비 중)":"게스트 모드 (로그인 준비 중)",c.style.color="rgba(148, 163, 184, .95)")),n&&(n.hidden=!!s),i&&(i.hidden=!s);const h=document.getElementById("authProviderButtons");h&&(h.style.display=s?"none":"flex");const m=document.getElementById("logoutButtonContainer");m&&(m.style.display=s?"flex":"none");const v=document.getElementById("authUserInfo");v&&(v.style.display=s?"block":"none");const L=document.getElementById("cloudSaveSection");L&&(L.style.display=s?"block":"none");const B=document.getElementById("guestSaveInfo");B&&(B.style.display=s?"none":"block")}const w=await R();b(w);const P=D(a=>b(a));async function I(a){if(!_()){d("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}d(e==="hub"?"Redirecting…":"이동 중…"),(await V(a)).ok||d(e==="hub"?"Login failed":"로그인 실패")}async function k(){if(!_())return;(await Y()).ok?d(e==="hub"?"Signed out":"로그아웃"):d(e==="hub"?"Logout failed":"로그아웃 실패")}return n&&n.addEventListener("click",a=>{a.preventDefault(),I(r)}),o.forEach(a=>{var h;const s=(h=a==null?void 0:a.dataset)==null?void 0:h.authProvider;s&&a.addEventListener("click",m=>{m.preventDefault(),I(s)})}),i&&i.addEventListener("click",a=>{a.preventDefault(),k()}),{off:P}}function l(t){return document.querySelector(t)}function E(t){const e=l("#toast");e&&(e.textContent=t,e.classList.add("show"),window.clearTimeout(E._t),E._t=window.setTimeout(()=>e.classList.remove("show"),1400))}function M(){return location.pathname.includes("/seoulsurvival/")?"game":"hub"}window.addEventListener("DOMContentLoaded",async()=>{const t=l("#loginBtn")||l("#authLoginBtn"),e=l("#logoutBtn")||l("#authLogoutBtn"),o=l("#authUserLabel"),r=l("#authStatusLabel"),n=Array.from(document.querySelectorAll("[data-auth-provider]"));!t&&n.length===0||await J({scope:M(),providerButtons:n,defaultProvider:"google",loginBtn:t,logoutBtn:e,userLabel:o,statusLabel:r,toast:E})});export{R as a,O as b,T as g,_ as i,D as o,V as s};

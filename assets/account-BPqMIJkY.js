const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./core-Cq47966W.js","./preload-helper-Bo3zgFBI.js","./preload-helper-DFlHEO2w.css","./supabaseClient-DfMY2obf.js","./ui-BV5JZo7K.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";import{_ as N}from"./preload-helper-Bo3zgFBI.js";/* empty css               *//* empty css            */import{r as S,a as H}from"./footer-BCqG-Vg5.js";import{signOut as V}from"./core-Cq47966W.js";import{deleteAccount as R}from"./deleteAccount-CF0X2lFv.js";import{validateNickname as P,claimNickname as G}from"./leaderboard-CYUKjqx6.js";import"./supabaseClient-DfMY2obf.js";function f(g,w="info"){const u=document.createElement("div");u.textContent=g,u.style.cssText=`
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-panel);
    color: var(--text);
    padding: 12px 24px;
    border-radius: 8px;
    border: 1px solid var(--border);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000;
    font-size: 14px;
  `,document.body.appendChild(u),setTimeout(()=>{u.style.opacity="0",u.style.transition="opacity 0.3s",setTimeout(()=>u.remove(),300)},2e3)}document.addEventListener("DOMContentLoaded",async()=>{var M;const g=document.getElementById("header-mount"),w=document.getElementById("footer-mount");g&&(S(g),await F()),w&&H(w);const{getUser:u,getUserProfile:C}=await N(async()=>{const{getUser:t,getUserProfile:n}=await import("./core-Cq47966W.js");return{getUser:t,getUserProfile:n}},__vite__mapDeps([0,1,2,3]),import.meta.url),r=await u(),c=!!r;async function v(){var i,p,D;const t=document.getElementById("account-avatar-text"),n=document.getElementById("account-name"),o=document.getElementById("account-email");if(!c){n&&(n.textContent="게스트"),o&&(o.textContent="로그인이 필요합니다"),t&&(t.textContent="?");return}try{const b=await C("seoulsurvival");if(b.success&&b.user){const T=b.user.nickname||b.user.displayName||((i=b.user.email)==null?void 0:i.split("@")[0])||"사용자";n&&(n.textContent=T),o&&b.user.email&&(o.textContent=b.user.email),t&&(t.textContent=T.charAt(0).toUpperCase())}}catch(b){console.warn("[Account] Failed to load profile:",b),n&&(n.textContent=((p=r==null?void 0:r.email)==null?void 0:p.split("@")[0])||"사용자"),o&&(r!=null&&r.email)&&(o.textContent=r.email),t&&(t.textContent=(((D=r==null?void 0:r.email)==null?void 0:D.charAt(0))||"?").toUpperCase())}}await v(),c||document.querySelectorAll(".account-menu-item").forEach(n=>{n.style.opacity="0.5",n.style.pointerEvents="none"});const d=document.getElementById("nickname-input"),l=document.getElementById("nickname-save"),k=document.getElementById("current-nickname-display"),e=document.getElementById("current-nickname-text"),m=document.getElementById("cooldown-display"),A=document.getElementById("cooldown-timer"),a=document.getElementById("nickname-error"),B=3e4,L="clicksurvivor_lastNicknameChangeAt";function I(){try{const t=localStorage.getItem(L);if(!t)return{allowed:!0};const n=parseInt(t,10),i=Date.now()-n;return i>=B?{allowed:!0}:{allowed:!1,remainingSeconds:Math.ceil((B-i)/1e3)}}catch{return{allowed:!0}}}function U(){try{localStorage.setItem(L,String(Date.now()))}catch(t){console.warn("쿨타임 저장 실패:",t)}}function x(){if(!m||!d||!l)return;const t=I();t.allowed?(m.style.display="none",l.disabled=d.value.trim().length===0):(m.style.display="block",A&&(A.textContent=`${t.remainingSeconds}초`),l.disabled=!0)}let _=null;if(c&&m&&d&&l&&(x(),_=setInterval(x,1e3)),d&&l){if(!c)d.disabled=!0,l.disabled=!0,d.placeholder="로그인이 필요합니다",k&&(k.style.display="none"),m&&(m.style.display="none");else{const{getUserProfile:t}=await N(async()=>{const{getUserProfile:o}=await import("./core-Cq47966W.js");return{getUserProfile:o}},__vite__mapDeps([0,1,2,3]),import.meta.url),n=await t("seoulsurvival");n.success&&((M=n.user)!=null&&M.nickname)?k&&(k.style.display="block",e&&(e.textContent=n.user.nickname)):k&&(k.style.display="none")}d.addEventListener("input",()=>{const t=d.value.trim(),n=P(t),o=I();if(l.disabled=!n.ok||t.length===0||!o.allowed,t.length>0&&!n.ok){const i=O(n.reasonKey);a&&(a.textContent=i,a.style.display="block"),d.setCustomValidity(i)}else a&&(a.style.display="none"),d.setCustomValidity("")}),l.addEventListener("click",async()=>{if(!c){f("로그인이 필요합니다","error");return}const t=I();if(!t.allowed){f(`닉네임 변경 쿨타임이 남아있습니다 (${t.remainingSeconds}초)`,"error");return}const n=d.value.trim(),o=P(n);if(!o.ok){const i=O(o.reasonKey);f(i,"error"),a&&(a.textContent=i,a.style.display="block");return}l.disabled=!0,l.textContent="저장 중...",a&&(a.style.display="none");try{const i=await G(n,r.id);if(i.success)f("닉네임이 변경되었습니다","success"),d.value="",U(),x(),k&&(k.style.display="block",e&&(e.textContent=n)),await v(),window.dispatchEvent(new Event("authstatechange"));else{let p="닉네임 변경에 실패했습니다";i.error==="taken"?p="이미 사용 중인 닉네임입니다":i.message&&(p=i.message),f(p,"error"),a&&(a.textContent=p,a.style.display="block")}}catch(i){console.error("Nickname change error:",i);const p="닉네임 변경 중 오류가 발생했습니다";f(p,"error"),a&&(a.textContent=p,a.style.display="block")}finally{x(),l.textContent="저장"}})}window.addEventListener("beforeunload",()=>{_&&clearInterval(_)});const s=document.getElementById("logout-btn");s&&(c?(s.disabled=!1,s.addEventListener("click",async()=>{if(confirm("로그아웃하시겠습니까?")){s.disabled=!0,s.textContent="로그아웃 중...";try{(await V()).ok?(f("로그아웃되었습니다","success"),setTimeout(()=>{window.location.href="../"},500)):(f("로그아웃에 실패했습니다","error"),s.disabled=!1,s.textContent="모든 기기에서 로그아웃")}catch(t){console.error("Logout error:",t),f("로그아웃 중 오류가 발생했습니다","error"),s.disabled=!1,s.textContent="Logout"}}})):(s.disabled=!0,s.textContent="로그인 필요"));const y=document.getElementById("delete-confirm-checkbox"),E=document.getElementById("delete-confirm-input"),h=document.getElementById("delete-account-btn");if(y&&E&&h){c||(y.disabled=!0,E.disabled=!0,h.disabled=!0,E.placeholder="로그인이 필요합니다");const t=()=>{if(!c)return;const n=y.checked,o=E.value.trim()==="DELETE";h.disabled=!(n&&o)};y.addEventListener("change",t),E.addEventListener("input",t),h.addEventListener("click",async()=>{if(!c){f("로그인이 필요합니다","error");return}if(confirm(`계정과 모든 데이터를 영구적으로 삭제하시겠습니까?

⚠️ 삭제될 내용:
• 계정 정보 (이메일, 로그인 정보)
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

이 작업은 되돌릴 수 없습니다.`)&&confirm(`정말로 계정을 삭제하시겠습니까?

이 작업은 되돌릴 수 없으며, 모든 데이터가 영구적으로 삭제됩니다.`)){h.disabled=!0,h.textContent="삭제 중...";try{const n=await R();if(n.ok)f("계정이 삭제되었습니다","success"),setTimeout(()=>{window.location.href="/"},1e3);else{let o="계정 삭제에 실패했습니다";n.status==="NOT_CONFIGURED"?o="계정 삭제 기능이 설정되지 않았습니다":n.status==="AUTH_FAILED"&&(o="로그인 상태가 만료되었습니다"),f(o,"error"),h.disabled=!1,h.textContent="Delete account"}}catch(n){console.error("Delete account error:",n),f("계정 삭제 중 오류가 발생했습니다","error"),h.disabled=!1,h.textContent="Delete account"}}})}console.log("[Account] 초기화 완료")});function O(g){return{empty:"닉네임을 입력해주세요",tooShort:"닉네임은 1자 이상이어야 합니다",tooLong:"닉네임은 6자 이하여야 합니다",invalid:"한글, 영문, 숫자, 밑줄만 사용 가능합니다 (공백 불가)",banned:"사용할 수 없는 닉네임입니다"}[g]||"닉네임이 유효하지 않습니다"}async function F(){try{const{initAuthUI:g}=await N(async()=>{const{initAuthUI:e}=await import("./ui-BV5JZo7K.js");return{initAuthUI:e}},__vite__mapDeps([4,1,2]),import.meta.url),{getUser:w,onAuthStateChange:u}=await N(async()=>{const{getUser:e,onAuthStateChange:m}=await import("./core-Cq47966W.js");return{getUser:e,onAuthStateChange:m}},__vite__mapDeps([0,1,2,3]),import.meta.url),C=document.getElementById("headerLoginBtn"),r=document.getElementById("headerLogoutBtn"),c=document.getElementById("headerAccountMenu"),v=document.getElementById("headerAccountNicknameMobile");if(!C&&!r)return;C&&(C.style.display="block"),c&&c.style.setProperty("display","none","important");async function d(e){var m,A,a,B,L,I,U,x,_;if(v){if(!e){v.textContent="Guest";return}try{const{getUserProfile:s}=await N(async()=>{const{getUserProfile:E}=await import("./core-Cq47966W.js");return{getUserProfile:E}},__vite__mapDeps([0,1,2,3]),import.meta.url),y=await s("seoulsurvival");if(y.success&&((m=y.user)!=null&&m.nickname))v.textContent=y.user.nickname,console.log("[Account] Nickname updated:",y.user.nickname);else{const E=((A=e==null?void 0:e.user_metadata)==null?void 0:A.full_name)||((a=e==null?void 0:e.user_metadata)==null?void 0:a.name)||((B=e==null?void 0:e.user_metadata)==null?void 0:B.preferred_username)||((L=e==null?void 0:e.email)==null?void 0:L.split("@")[0])||"Guest";v.textContent=E,console.log("[Account] Using fallback nickname:",E)}}catch(s){console.warn("[Account] Failed to get nickname:",s);const y=((I=e==null?void 0:e.user_metadata)==null?void 0:I.full_name)||((U=e==null?void 0:e.user_metadata)==null?void 0:U.name)||((x=e==null?void 0:e.user_metadata)==null?void 0:x.preferred_username)||((_=e==null?void 0:e.email)==null?void 0:_.split("@")[0])||"Guest";v.textContent=y,console.log("[Account] Using fallback nickname (error):",y)}}}async function l(e){const m=!!e;C&&(C.style.display=m?"none":"block"),c&&(m?c.style.setProperty("display","block","important"):c.style.setProperty("display","none","important")),await d(e)}const k=await w();await l(k),await g({scope:"hub",providerButtons:[],defaultProvider:"google",loginBtn:C,logoutBtn:r,userLabel:null,statusLabel:null,toast:e=>console.log("[Account]",e)}),setTimeout(async()=>{const e=await w();await l(e)},100),u(async e=>{await l(e)})}catch(g){console.warn("[Account] Header auth init failed, using guest mode:",g);const w=document.getElementById("headerLoginBtn"),u=document.getElementById("headerAccountMenu");w&&(w.style.display="block"),u&&u.style.setProperty("display","none","important")}}

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ui-BV5JZo7K.js","./preload-helper-Bo3zgFBI.js","./preload-helper-DFlHEO2w.css","./core-Cq47966W.js","./supabaseClient-DfMY2obf.js","./leaderboard-CYUKjqx6.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";import{_ as u}from"./preload-helper-Bo3zgFBI.js";/* empty css               *//* empty css            */import{r as X,a as Y}from"./footer-BCqG-Vg5.js";function y(w,h="info"){const s=document.createElement("div");s.textContent=w,s.style.cssText=`
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-panel);
    color: var(--text);
    padding: 12px 24px;
    border-radius: 8px;
    border: 1px solid var(--border);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000;
    font-size: 14px;
  `,document.body.appendChild(s),setTimeout(()=>{s.style.opacity="0",s.style.transition="opacity 0.3s",setTimeout(()=>s.remove(),300)},2e3)}document.addEventListener("DOMContentLoaded",async()=>{var D;const w=document.getElementById("header-mount"),h=document.getElementById("footer-mount");if(w){X(w);try{const{initAuthUI:t}=await u(async()=>{const{initAuthUI:e}=await import("./ui-BV5JZo7K.js");return{initAuthUI:e}},__vite__mapDeps([0,1,2]),import.meta.url),{getUser:o,onAuthStateChange:c}=await u(async()=>{const{getUser:e,onAuthStateChange:f}=await import("./core-Cq47966W.js");return{getUser:e,onAuthStateChange:f}},__vite__mapDeps([3,1,2,4]),import.meta.url),n=document.getElementById("headerLoginBtn"),i=document.getElementById("headerLogoutBtn"),m=document.getElementById("headerAccountMenu"),p=document.getElementById("headerAccountNicknameMobile");if(!n&&!i)return;n&&(n.style.display="block"),m&&m.style.setProperty("display","none","important");async function O(e){var T,S,U,V,H,R,K,G,z;const f=!!e;if(n&&(n.style.display=f?"none":"block"),m&&(f?m.style.setProperty("display","block","important"):m.style.setProperty("display","none","important")),p&&f)try{const{getUserProfile:C}=await u(async()=>{const{getUserProfile:x}=await import("./core-Cq47966W.js");return{getUserProfile:x}},__vite__mapDeps([3,1,2,4]),import.meta.url),g=await C("seoulsurvival");if(g.success&&((T=g.user)!=null&&T.nickname))p.textContent=g.user.nickname;else{const x=((S=e==null?void 0:e.user_metadata)==null?void 0:S.full_name)||((U=e==null?void 0:e.user_metadata)==null?void 0:U.name)||((V=e==null?void 0:e.user_metadata)==null?void 0:V.preferred_username)||((H=e==null?void 0:e.email)==null?void 0:H.split("@")[0])||"Guest";p.textContent=x}}catch(C){console.warn("[Header] Failed to get nickname:",C);const g=((R=e==null?void 0:e.user_metadata)==null?void 0:R.full_name)||((K=e==null?void 0:e.user_metadata)==null?void 0:K.name)||((G=e==null?void 0:e.user_metadata)==null?void 0:G.preferred_username)||((z=e==null?void 0:e.email)==null?void 0:z.split("@")[0])||"Guest";p.textContent=g}}const $=await o();await O($),await t({scope:"hub",providerButtons:[],defaultProvider:"google",loginBtn:n,logoutBtn:i,userLabel:p,statusLabel:null,toast:e=>console.log("[Header]",e)}),c(async e=>{await O(e)})}catch(t){console.warn("[Header] Auth init failed:",t)}}h&&Y(h);const{getUser:s}=await u(async()=>{const{getUser:t}=await import("./core-Cq47966W.js");return{getUser:t}},__vite__mapDeps([3,1,2,4]),import.meta.url),{validateNickname:A,claimNickname:F}=await u(async()=>{const{validateNickname:t,claimNickname:o}=await import("./leaderboard-CYUKjqx6.js");return{validateNickname:t,claimNickname:o}},__vite__mapDeps([5,4,1,2,3]),import.meta.url),N=await s(),E=!!N,l=document.getElementById("nickname-input"),r=document.getElementById("nickname-save"),d=document.getElementById("current-nickname-display"),_=document.getElementById("current-nickname-text"),k=document.getElementById("cooldown-display"),B=document.getElementById("cooldown-timer"),a=document.getElementById("nickname-error"),L=3e4,M="clicksurvivor_lastNicknameChangeAt";function I(){try{const t=localStorage.getItem(M);if(!t)return{allowed:!0};const o=parseInt(t,10),n=Date.now()-o;return n>=L?{allowed:!0}:{allowed:!1,remainingSeconds:Math.ceil((L-n)/1e3)}}catch{return{allowed:!0}}}function W(){try{localStorage.setItem(M,String(Date.now()))}catch(t){console.warn("쿨타임 저장 실패:",t)}}function v(){const t=I();t.allowed?(k.style.display="none",r&&(r.disabled=l.value.trim().length===0)):(k.style.display="block",B&&(B.textContent=`${t.remainingSeconds}초`),r&&(r.disabled=!0))}function P(t){return{too_short:"닉네임은 최소 1자 이상이어야 합니다",too_long:"닉네임은 최대 6자까지 가능합니다",invalid_chars:"닉네임에는 한글, 영문, 숫자만 사용할 수 있습니다",empty:"닉네임을 입력해주세요"}[t]||"닉네임이 유효하지 않습니다"}let b=null;if(E&&(v(),b=setInterval(v,1e3)),l&&r){if(!E)l.disabled=!0,r.disabled=!0,l.placeholder="로그인이 필요합니다",d&&(d.style.display="none"),k&&(k.style.display="none");else{const{getUserProfile:t}=await u(async()=>{const{getUserProfile:c}=await import("./core-Cq47966W.js");return{getUserProfile:c}},__vite__mapDeps([3,1,2,4]),import.meta.url),o=await t("seoulsurvival");o.success&&((D=o.user)!=null&&D.nickname)?d&&(d.style.display="block",_&&(_.textContent=o.user.nickname)):d&&(d.style.display="none")}l.addEventListener("input",()=>{const t=l.value.trim(),o=A(t),c=I();if(r.disabled=!o.ok||t.length===0||!c.allowed,t.length>0&&!o.ok){const n=P(o.reasonKey);a&&(a.textContent=n,a.style.display="block"),l.setCustomValidity(n)}else a&&(a.style.display="none"),l.setCustomValidity("")}),r.addEventListener("click",async()=>{if(!E){y("로그인이 필요합니다","error");return}const t=I();if(!t.allowed){y(`닉네임 변경 쿨타임이 남아있습니다 (${t.remainingSeconds}초)`,"error");return}const o=l.value.trim(),c=A(o);if(!c.ok){const n=P(c.reasonKey);y(n,"error"),a&&(a.textContent=n,a.style.display="block");return}r.disabled=!0,r.textContent="저장 중...",a&&(a.style.display="none");try{const n=await F(o,N.id);if(n.success){y("닉네임이 변경되었습니다","success"),l.value="",W(),v(),d&&(d.style.display="block",_&&(_.textContent=o));const i=document.getElementById("headerAccountNicknameMobile");i&&(i.textContent=o),window.dispatchEvent(new Event("authstatechange")),window.dispatchEvent(new CustomEvent("nicknamechanged",{detail:{nickname:o}}));try{localStorage.setItem("clicksurvivor_nickname_changed",String(Date.now()))}catch(m){console.warn("닉네임 변경 플래그 저장 실패:",m)}}else{let i="닉네임 변경에 실패했습니다";n.error==="taken"?i="이미 사용 중인 닉네임입니다":n.message&&(i=n.message),y(i,"error"),a&&(a.textContent=i,a.style.display="block")}}catch(n){console.error("Nickname change error:",n);const i="닉네임 변경 중 오류가 발생했습니다";y(i,"error"),a&&(a.textContent=i,a.style.display="block")}finally{v(),r.textContent="저장"}})}window.addEventListener("beforeunload",()=>{b&&clearInterval(b)})});

import{createClient as Y}from"https://esm.sh/@supabase/supabase-js@2.49.1";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const V={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52eGR3YWNxbWlvZnBlbm51a2VvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTMwNDYsImV4cCI6MjA4MTQ2OTA0Nn0.v2UoOk7xdmascY10Oy8fT3kYTWm9gWKSC9C4wH4nwP4",VITE_SUPABASE_URL:"https://nvxdwacqmiofpennukeo.supabase.co"},L=typeof import.meta<"u"&&V?V:{};try{console.log("[env] VITE_SUPABASE_URL:",L.VITE_SUPABASE_URL),console.log("[env] VITE_SUPABASE_ANON_KEY length:",(L.VITE_SUPABASE_ANON_KEY||"").length)}catch{}const y=L.VITE_SUPABASE_URL??"",A=L.VITE_SUPABASE_ANON_KEY??"",G="clicksurvivor-auth";function W(){const e=typeof y=="string"&&typeof A=="string"&&y.startsWith("https://")&&y.length>8&&A.length>0;if(!e)try{console.warn("[auth] Supabase not configured",{urlEmpty:!y,anonEmpty:!A,urlValue:y||"(empty)",anonLen:(A||"").length})}catch{}return e}function U(){return W()?Y(y,A,{auth:{storageKey:G,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}):null}let I=null;function p(){return I||(I=U(),I)}function k(){return W()}async function H(){const e=p();if(!e)return{ok:!1,reason:"not_configured"};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:r}=await e.auth.exchangeCodeForSession(location.href);if(r)return{ok:!1,reason:"exchange_failed",error:r};const a=new URL(location.href);return a.searchParams.delete("code"),a.searchParams.delete("state"),history.replaceState(null,"",a.toString()),{ok:!0,exchanged:!0}}catch(r){return{ok:!1,reason:"exchange_failed",error:r}}}async function T(){const e=p();if(!e)return null;const{data:t}=await e.auth.getUser();return(t==null?void 0:t.user)||null}async function j(e){const t=p();if(!t)return{ok:!1,reason:"not_configured"};const r=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"),{error:a}=await t.auth.signInWithOAuth({provider:e,options:{redirectTo:r}});return a?{ok:!1,reason:"oauth_failed",error:a}:{ok:!0}}async function J(){const e=p();if(!e)return{ok:!1,reason:"not_configured"};const{error:t}=await e.auth.signOut();return t?{ok:!1,reason:"signout_failed",error:t}:{ok:!0}}function q(e){const t=p();if(!t)return()=>{};const{data:r}=t.auth.onAuthStateChange((a,o)=>{e((o==null?void 0:o.user)||null)});return()=>r.subscription.unsubscribe()}async function Z(){const e=U();if(!e)return{ok:!1,reason:"not_configured"};const t=await T();if(!t)return{ok:!1,reason:"not_signed_in"};try{const{error:r}=await e.from("game_saves").delete().eq("user_id",t.id);if(r)return console.error("Failed to delete game_saves:",r),{ok:!1,reason:"delete_saves_failed",error:r};const{error:a}=await e.from("leaderboard").delete().eq("user_id",t.id);return a?(console.error("Failed to delete leaderboard:",a),{ok:!1,reason:"delete_leaderboard_failed",error:a}):{ok:!0}}catch(r){return console.error("Exception while deleting user data:",r),{ok:!1,reason:"exception",error:r}}}async function z(){const e=U();if(!e)return{ok:!1,status:"NOT_CONFIGURED",reason:"not_configured"};if(!await T())return{ok:!1,status:"AUTH_FAILED",reason:"not_signed_in"};const{data:{session:r},error:a}=await e.auth.getSession();if(a||!(r!=null&&r.access_token))return{ok:!1,status:"AUTH_FAILED",reason:"no_session",error:a};const o=r.access_token,i=`${y}/functions/v1/delete-account`;try{const n=new AbortController,s=setTimeout(()=>n.abort(),3e4),f=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(s),!f.ok){let h;try{h=await f.json()}catch{h={status:"UNKNOWN_ERROR",message:`HTTP ${f.status}`}}return{ok:!1,status:h.status||"UNKNOWN_ERROR",reason:h.message||`HTTP ${f.status}`,error:h,httpStatus:f.status}}const c=await f.json();return c.status==="ALL_SUCCESS"?{ok:!0,status:"ALL_SUCCESS"}:c.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?{ok:!1,status:"DATA_DELETED_BUT_AUTH_DELETE_FAILED",reason:"Data deleted but account deletion failed"}:{ok:!1,status:c.status||"UNKNOWN_ERROR",reason:c.message||"Unknown error"}}catch(n){return n.name==="AbortError"?{ok:!1,status:"UNKNOWN_ERROR",reason:"timeout",error:n}:(console.error("Delete account exception:",n),{ok:!1,status:"UNKNOWN_ERROR",reason:"network_error",error:n})}}function X(e){var t,r,a,o;return e?((t=e.user_metadata)==null?void 0:t.full_name)||((r=e.user_metadata)==null?void 0:r.name)||((a=e.user_metadata)==null?void 0:a.preferred_username)||e.email||((o=e.id)==null?void 0:o.slice(0,8)):null}function Q(e){return e&&e.email||null}async function ee(e){const{scope:t="hub",providerButtons:r=[],defaultProvider:a="google",loginBtn:o,logoutBtn:i,userLabel:n,statusLabel:s,toast:f}=e||{},c=typeof f=="function"?f:()=>{};await H();function h(u){const l=X(u);if(n&&(n.textContent=l||(t==="hub"?"Guest":"게스트"),n.hidden=!1,n.setAttribute("aria-hidden","false")),s&&(k()?l?(s.textContent=t==="hub"?"Signed in":"로그인됨",s.style.color="rgba(52, 211, 153, .95)"):(s.textContent=t==="hub"?"Not signed in":"로그인 안 됨",s.style.color="rgba(148, 163, 184, .95)"):(s.textContent=t==="hub"?"Guest mode (로그인 준비 중)":"게스트 모드 (로그인 준비 중)",s.style.color="rgba(148, 163, 184, .95)")),o){const g=!!l;o.hidden=g,o.setAttribute("aria-hidden",g?"true":"false"),o.setAttribute("tabindex",g?"-1":"0")}if(i){const g=!!l;i.hidden=!g,i.setAttribute("aria-hidden",g?"false":"true"),i.setAttribute("tabindex",g?"0":"-1")}const S=document.getElementById("authProviderButtons");S&&(S.style.display=l?"none":"flex");const v=document.getElementById("accountGuestInfo");v&&(v.style.display=l?"none":"block");const O=document.getElementById("accountLoggedInInfo");O&&(O.style.display=l?"block":"none");const N=document.getElementById("accountOverviewSection");N&&(N.style.display=l?"block":"none");const C=document.getElementById("preferencesSection");C&&(C.style.display="block");const R=document.getElementById("privacyDataSection");R&&(R.style.display=l?"block":"none");const P=document.getElementById("dangerZoneSection");P&&(P.style.display=l?"block":"none");const x=document.getElementById("authUserInfo");if(x){x.style.display=l?"block":"none";const g=document.getElementById("authUserEmail");if(g){const M=Q(u);g.textContent=M||"(이메일 없음)"}const $=document.getElementById("authUserName");$&&($.textContent=l||"Guest")}const F=document.getElementById("cloudSaveSection");F&&(F.style.display=l?"block":"none");const K=document.getElementById("guestSaveInfo");K&&(K.style.display=l?"none":"block")}const d=await T();h(d);const E=q(u=>h(u));async function _(u){if(!k()){c("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}c(t==="hub"?"Redirecting…":"이동 중…"),(await j(u)).ok||c(t==="hub"?"Login failed":"로그인 실패")}async function b(){if(!k())return;(await J()).ok?c(t==="hub"?"Signed out":"로그아웃"):c(t==="hub"?"Logout failed":"로그아웃 실패")}o&&o.addEventListener("click",u=>{u.preventDefault(),_(a)}),r.forEach(u=>{var S;const l=(S=u==null?void 0:u.dataset)==null?void 0:S.authProvider;l&&u.addEventListener("click",v=>{v.preventDefault(),_(l)})}),i&&i.addEventListener("click",u=>{u.preventDefault(),b()});const B=document.getElementById("deleteDataBtn");B&&B.addEventListener("click",async u=>{u.preventDefault(),await te(t,c,b)});const D=document.getElementById("deleteAccountBtn");return D&&D.addEventListener("click",async u=>{u.preventDefault(),await ne(t,c,b)}),{off:E}}async function te(e,t,r){var s,f,c,h;const a=typeof t=="function"?t:()=>{};if(!confirm(`모든 클라우드 데이터(저장, 리더보드)와 로컬 게임 저장을 삭제하시겠습니까?

⚠️ 이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 삭제하시겠습니까?

삭제될 데이터:
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.`))return;a(e==="hub"?"Deleting data…":"데이터 삭제 중…");let n;try{n=await Z()}catch(d){console.error("Delete user data exception:",d),a("데이터 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!n.ok){let d;if(n.reason==="not_configured")d="데이터 삭제 기능이 설정되지 않았습니다.";else if(n.reason==="not_signed_in")d="로그인 상태가 아닙니다. 다시 로그인해주세요.";else if(n.reason==="delete_saves_failed"||n.reason==="delete_leaderboard_failed"){const E=((s=n.error)==null?void 0:s.code)||((f=n.error)==null?void 0:f.status)||"";E===401||E===403?d="권한이 없습니다. 다시 로그인해주세요.":d=e==="hub"?`데이터 삭제 실패: ${n.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`:`데이터 삭제 실패: ${n.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`}else d=e==="hub"?`데이터 삭제 실패: ${n.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`데이터 삭제 실패: ${n.reason||"알 수 없는 오류"}. 다시 시도해주세요.`;a(d),console.error("Delete user data failed:",n),(n.reason==="not_signed_in"||((c=n.error)==null?void 0:c.code)===401||((h=n.error)==null?void 0:h.code)===403)&&setTimeout(()=>{confirm("로그아웃하시겠습니까?")&&r()},1e3);return}try{const d=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(_=>{_.startsWith("clicksurvivor-")&&_!=="clicksurvivor_lang"&&d.push(_)}),d.forEach(_=>{try{localStorage.removeItem(_)}catch(b){console.warn(`Failed to remove localStorage key "${_}":`,b)}})}catch(d){console.warn("Failed to clear localStorage:",d)}a(e==="hub"?"Data deleted. Signing out…":"데이터가 삭제되었습니다. 로그아웃 중…"),await r(),setTimeout(()=>{window.location.reload()},500)}async function ne(e,t,r){const a=typeof t=="function"?t:()=>{};if(!confirm(`계정과 모든 데이터를 영구적으로 삭제하시겠습니까?

⚠️ 삭제될 내용:
• 계정 정보 (이메일, 로그인 정보)
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 계정을 삭제하시겠습니까?

이 작업은 다음을 포함합니다:
• 계정 정보 완전 삭제
• 모든 클라우드 데이터 삭제
• 모든 로컬 게임 저장 삭제

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.

이 작업은 되돌릴 수 없습니다.`))return;a(e==="hub"?"Deleting account…":"계정 삭제 중…");let n;try{n=await z()}catch(s){console.error("Delete account exception:",s),a("계정 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!n.ok){let s;n.status==="NOT_CONFIGURED"?s="계정 삭제 기능이 설정되지 않았습니다. 고객지원에 문의해주세요.":n.status==="AUTH_FAILED"?s="로그인 상태가 만료되었습니다. 다시 로그인해주세요.":n.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?s="데이터는 삭제되었지만 계정 삭제에 실패했습니다. 고객지원에 문의해주세요.":n.reason==="timeout"?s="요청 시간이 초과되었습니다. 네트워크 연결을 확인하고 다시 시도해주세요.":n.reason==="network_error"?s="네트워크 오류가 발생했습니다. 연결을 확인하고 다시 시도해주세요.":n.httpStatus===404?s="계정 삭제 기능이 아직 준비되지 않았습니다. 고객지원에 문의해주세요.":s=e==="hub"?`계정 삭제 실패: ${n.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`계정 삭제 실패: ${n.reason||"알 수 없는 오류"}. 다시 시도해주세요.`,a(s),console.error("Delete account failed:",n);return}try{const s=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(c=>{c.startsWith("clicksurvivor-")&&c!=="clicksurvivor_lang"&&s.push(c)}),s.forEach(c=>{try{localStorage.removeItem(c)}catch(h){console.warn(`Failed to remove localStorage key "${c}":`,h)}})}catch(s){console.warn("Failed to clear localStorage:",s)}a(e==="hub"?"Account deleted. Signing out…":"계정이 삭제되었습니다. 로그아웃 중…");try{await r()}catch(s){console.warn("Logout after account deletion failed (expected):",s)}setTimeout(()=>{window.location.reload()},1e3)}function m(e){return document.querySelector(e)}function w(e){const t=m("#toast");t&&(t.textContent=e,t.classList.add("show"),window.clearTimeout(w._t),w._t=window.setTimeout(()=>t.classList.remove("show"),1400))}function oe(){return location.pathname.includes("/seoulsurvival/")?"game":"hub"}window.addEventListener("DOMContentLoaded",async()=>{const e=m("#loginBtn")||m("#authLoginBtn"),t=m("#logoutBtn")||m("#authLogoutBtn"),r=m("#authUserLabel"),a=m("#authStatusLabel"),o=Array.from(document.querySelectorAll("[data-auth-provider]")),i=m("#drawerAuthLoginBtn"),n=m("#drawerAuthLogoutBtn"),s=m("#drawerAuthUserLabel");!e&&!i&&o.length===0||await ee({scope:oe(),providerButtons:o,defaultProvider:"google",loginBtn:e||i,logoutBtn:t||n,userLabel:r||s,statusLabel:a,toast:w})});export{T as a,W as b,U as g,k as i,q as o,j as s};

import{createClient as C}from"https://esm.sh/@supabase/supabase-js@2.49.1";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const U={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52eGR3YWNxbWlvZnBlbm51a2VvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTMwNDYsImV4cCI6MjA4MTQ2OTA0Nn0.v2UoOk7xdmascY10Oy8fT3kYTWm9gWKSC9C4wH4nwP4",VITE_SUPABASE_URL:"https://nvxdwacqmiofpennukeo.supabase.co"},S=typeof import.meta<"u"&&U?U:{};try{console.log("[env] VITE_SUPABASE_URL:",S.VITE_SUPABASE_URL),console.log("[env] VITE_SUPABASE_ANON_KEY length:",(S.VITE_SUPABASE_ANON_KEY||"").length)}catch{}const f=S.VITE_SUPABASE_URL??"",g=S.VITE_SUPABASE_ANON_KEY??"",N="clicksurvivor-auth";function w(){const t=typeof f=="string"&&typeof g=="string"&&f.startsWith("https://")&&f.length>8&&g.length>0;if(!t)try{console.warn("[auth] Supabase not configured",{urlEmpty:!f,anonEmpty:!g,urlValue:f||"(empty)",anonLen:(g||"").length})}catch{}return t}function T(){return w()?C(f,g,{auth:{storageKey:N,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}):null}let y=null;function p(){return y||(y=T(),y)}function _(){return w()}async function x(){const t=p();if(!t)return{ok:!1,reason:"not_configured"};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:r}=await t.auth.exchangeCodeForSession(location.href);if(r)return{ok:!1,reason:"exchange_failed",error:r};const a=new URL(location.href);return a.searchParams.delete("code"),a.searchParams.delete("state"),history.replaceState(null,"",a.toString()),{ok:!0,exchanged:!0}}catch(r){return{ok:!1,reason:"exchange_failed",error:r}}}async function R(){const t=p();if(!t)return null;const{data:e}=await t.auth.getUser();return(e==null?void 0:e.user)||null}async function V(t){const e=p();if(!e)return{ok:!1,reason:"not_configured"};const r=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"),{error:a}=await e.auth.signInWithOAuth({provider:t,options:{redirectTo:r}});return a?{ok:!1,reason:"oauth_failed",error:a}:{ok:!0}}async function Y(){const t=p();if(!t)return{ok:!1,reason:"not_configured"};const{error:e}=await t.auth.signOut();return e?{ok:!1,reason:"signout_failed",error:e}:{ok:!0}}function D(t){const e=p();if(!e)return()=>{};const{data:r}=e.auth.onAuthStateChange((a,n)=>{t((n==null?void 0:n.user)||null)});return()=>r.subscription.unsubscribe()}function K(t){var e,r,a,n;return t?((e=t.user_metadata)==null?void 0:e.full_name)||((r=t.user_metadata)==null?void 0:r.name)||((a=t.user_metadata)==null?void 0:a.preferred_username)||t.email||((n=t.id)==null?void 0:n.slice(0,8)):null}async function J(t){const{scope:e="hub",providerButtons:r=[],defaultProvider:a="google",loginBtn:n,logoutBtn:o,userLabel:c,statusLabel:l,toast:E}=t||{},d=typeof E=="function"?E:()=>{};await x();function b(i){const s=K(i);c&&(c.textContent=s||(e==="hub"?"Guest":"게스트"),c.hidden=!1),l&&(_()?s?(l.textContent=e==="hub"?"Signed in":"로그인됨",l.style.color="rgba(52, 211, 153, .95)"):(l.textContent=e==="hub"?"Not signed in":"로그인 안 됨",l.style.color="rgba(148, 163, 184, .95)"):(l.textContent=e==="hub"?"Guest mode (로그인 준비 중)":"게스트 모드 (로그인 준비 중)",l.style.color="rgba(148, 163, 184, .95)")),n&&(n.hidden=!!s),o&&(o.hidden=!s);const h=document.getElementById("authProviderButtons");h&&(h.style.display=s?"none":"flex");const m=document.getElementById("logoutButtonContainer");m&&(m.style.display=s?"flex":"none");const B=document.getElementById("authUserInfo");B&&(B.style.display=s?"block":"none");const I=document.getElementById("cloudSaveSection");I&&(I.style.display=s?"block":"none");const v=document.getElementById("guestSaveInfo");v&&(v.style.display=s?"none":"block")}const O=await R();b(O);const P=D(i=>b(i));async function L(i){if(!_()){d("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}d(e==="hub"?"Redirecting…":"이동 중…"),(await V(i)).ok||d(e==="hub"?"Login failed":"로그인 실패")}async function k(){if(!_())return;(await Y()).ok?d(e==="hub"?"Signed out":"로그아웃"):d(e==="hub"?"Logout failed":"로그아웃 실패")}return n&&n.addEventListener("click",i=>{i.preventDefault(),L(a)}),r.forEach(i=>{var h;const s=(h=i==null?void 0:i.dataset)==null?void 0:h.authProvider;s&&i.addEventListener("click",m=>{m.preventDefault(),L(s)})}),o&&o.addEventListener("click",i=>{i.preventDefault(),k()}),{off:P}}function u(t){return document.querySelector(t)}function A(t){const e=u("#toast");e&&(e.textContent=t,e.classList.add("show"),window.clearTimeout(A._t),A._t=window.setTimeout(()=>e.classList.remove("show"),1400))}function M(){return location.pathname.includes("/seoulsurvival/")?"game":"hub"}window.addEventListener("DOMContentLoaded",async()=>{const t=u("#loginBtn")||u("#authLoginBtn"),e=u("#logoutBtn")||u("#authLogoutBtn"),r=u("#authUserLabel"),a=u("#authStatusLabel"),n=Array.from(document.querySelectorAll("[data-auth-provider]")),o=u("#drawerAuthLoginBtn"),c=u("#drawerAuthLogoutBtn"),l=u("#drawerAuthUserLabel");!t&&!o&&n.length===0||await J({scope:M(),providerButtons:n,defaultProvider:"google",loginBtn:t||o,logoutBtn:e||c,userLabel:r||l,statusLabel:a,toast:A})});export{R as a,w as b,T as g,_ as i,D as o,V as s};

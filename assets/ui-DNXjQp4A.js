const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./core-DFjEd1v7.js","./preload-helper-WPMeT1xN.js","./preload-helper-DFlHEO2w.css","./supabaseClient-BZSWgoCJ.js","./deleteAccount-Co5dRfwP.js","./leaderboard-1jeTildv.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./preload-helper-WPMeT1xN.js";function M(e){var a,f,h,r;return e?((a=e.user_metadata)==null?void 0:a.full_name)||((f=e.user_metadata)==null?void 0:f.name)||((h=e.user_metadata)==null?void 0:h.preferred_username)||e.email||((r=e.id)==null?void 0:r.slice(0,8)):null}function N(e){return e&&e.email||null}async function W(e){const{scope:a="hub",providerButtons:f=[],defaultProvider:h="google",loginBtn:r,logoutBtn:m,userLabel:b,statusLabel:t,toast:o}=e||{},s=typeof o=="function"?o:()=>{},{initAuthFromUrl:u,getUser:v,isAuthEnabled:c,onAuthStateChange:E,signInWithOAuth:g,signOut:w}=await S(async()=>{const{initAuthFromUrl:i,getUser:n,isAuthEnabled:l,onAuthStateChange:y,signInWithOAuth:_,signOut:I}=await import("./core-DFjEd1v7.js");return{initAuthFromUrl:i,getUser:n,isAuthEnabled:l,onAuthStateChange:y,signInWithOAuth:_,signOut:I}},__vite__mapDeps([0,1,2,3]),import.meta.url);await u();function k(i){const n=M(i);if(b&&(b.textContent=n||(a==="hub"?"Guest":"게스트"),b.hidden=!1,b.setAttribute("aria-hidden","false")),t&&(n?(t.textContent=a==="hub"?"Signed in":"로그인됨",t.style.color="rgba(52, 211, 153, .95)"):(t.textContent=a==="hub"?"Not signed in":"로그인 안 됨",t.style.color="rgba(148, 163, 184, .95)")),r){const d=!!n;r.hidden=d,r.setAttribute("aria-hidden",d?"true":"false"),r.setAttribute("tabindex",d?"-1":"0")}if(m){const d=!!n;m.hidden=!d,m.setAttribute("aria-hidden",d?"false":"true"),m.setAttribute("tabindex",d?"0":"-1")}const l=document.getElementById("authProviderButtons");l&&(l.style.display=n?"none":"flex");const y=document.getElementById("accountGuestInfo");y&&(y.style.display=n?"none":"block");const _=document.getElementById("accountLoggedInInfo");_&&(_.style.display=n?"block":"none");const I=document.getElementById("accountOverviewSection");I&&(I.style.display=n?"block":"none");const p=document.getElementById("preferencesSection");p&&(p.style.display="block");const T=document.getElementById("privacyDataSection");T&&(T.style.display=n?"block":"none");const U=document.getElementById("dangerZoneSection");U&&(U.style.display=n?"block":"none");const O=document.getElementById("authUserInfo");if(O){O.style.display=n?"block":"none";const d=document.getElementById("authUserEmail");if(d){const G=N(i);d.textContent=G||"(이메일 없음)"}const F=document.getElementById("authUserName");F&&(F.textContent=n||"Guest")}const x=document.getElementById("cloudSaveSection");x&&(x.style.display=n?"block":"none");const C=document.getElementById("guestSaveInfo");C&&(C.style.display=n?"none":"block")}const P=await v();k(P);const $=E(i=>k(i));async function A(i){if(!await c()){s("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}if(s(a==="hub"?"Redirecting…":"이동 중…"),i==="google"){const{signInGoogle:n}=await S(async()=>{const{signInGoogle:y}=await import("./core-DFjEd1v7.js");return{signInGoogle:y}},__vite__mapDeps([0,1,2,3]),import.meta.url);(await n()).ok||s(a==="hub"?"Login failed":"로그인 실패")}else(await g(i)).ok||s(a==="hub"?"Login failed":"로그인 실패")}async function D(){if(!await c())return;if(!(await w()).ok){s(a==="hub"?"Logout failed":"로그아웃 실패");return}s(a==="hub"?"Signed out":"로그아웃"),typeof window<"u"&&setTimeout(()=>{const n=window.location.pathname;let l="/";n.includes("/account/")?l="../":n.includes("/auth/callback/")?l="../../":n.includes("/seoulsurvival/")?l="../":n!=="/"&&(l="/"),window.location.href=l},500)}r&&r.addEventListener("click",i=>{i.preventDefault(),A(h)}),f.forEach(i=>{var l;const n=(l=i==null?void 0:i.dataset)==null?void 0:l.authProvider;n&&i.addEventListener("click",y=>{y.preventDefault(),A(n)})}),m&&m.addEventListener("click",i=>{i.preventDefault(),D()});const L=document.getElementById("deleteDataBtn");L&&L.addEventListener("click",async i=>{i.preventDefault(),await R(a,s,D)});const B=document.getElementById("deleteAccountBtn");return B&&B.addEventListener("click",async i=>{i.preventDefault();const{deleteAccount:n}=await S(async()=>{const{deleteAccount:l}=await import("./deleteAccount-Co5dRfwP.js");return{deleteAccount:l}},__vite__mapDeps([4,1,2,3,0,5]),import.meta.url);await V(a,s,D,n)}),{off:$}}async function R(e,a,f,h){var o,s,u,v;const r=typeof a=="function"?a:()=>{};if(!confirm(`모든 클라우드 데이터(저장, 리더보드)와 로컬 게임 저장을 삭제하시겠습니까?

⚠️ 이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 삭제하시겠습니까?

삭제될 데이터:
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.`))return;r(e==="hub"?"Deleting data…":"데이터 삭제 중…");let t;try{t=await h()}catch(c){console.error("Delete user data exception:",c),r("데이터 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!t.ok){let c;if(t.reason==="not_configured")c="데이터 삭제 기능이 설정되지 않았습니다.";else if(t.reason==="not_signed_in")c="로그인 상태가 아닙니다. 다시 로그인해주세요.";else if(t.reason==="delete_saves_failed"||t.reason==="delete_leaderboard_failed"){const E=((o=t.error)==null?void 0:o.code)||((s=t.error)==null?void 0:s.status)||"";E===401||E===403?c="권한이 없습니다. 다시 로그인해주세요.":c=e==="hub"?`데이터 삭제 실패: ${t.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`:`데이터 삭제 실패: ${t.reason}. 네트워크 연결을 확인하고 다시 시도해주세요.`}else c=e==="hub"?`데이터 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`데이터 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`;r(c),console.error("Delete user data failed:",t),(t.reason==="not_signed_in"||((u=t.error)==null?void 0:u.code)===401||((v=t.error)==null?void 0:v.code)===403)&&setTimeout(()=>{confirm("로그아웃하시겠습니까?")&&f()},1e3);return}try{const c=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(g=>{g.startsWith("clicksurvivor-")&&g!=="clicksurvivor_lang"&&c.push(g)}),c.forEach(g=>{try{localStorage.removeItem(g)}catch(w){console.warn(`Failed to remove localStorage key "${g}":`,w)}})}catch(c){console.warn("Failed to clear localStorage:",c)}r(e==="hub"?"Data deleted. Signing out…":"데이터가 삭제되었습니다. 로그아웃 중…"),await f(),setTimeout(()=>{window.location.reload()},500)}async function V(e,a,f,h){const r=typeof a=="function"?a:()=>{};if(!confirm(`계정과 모든 데이터를 영구적으로 삭제하시겠습니까?

⚠️ 삭제될 내용:
• 계정 정보 (이메일, 로그인 정보)
• 클라우드 저장
• 리더보드 기록
• 로컬 게임 저장

이 작업은 되돌릴 수 없으며, 삭제 후에는 로그아웃됩니다.

언어 설정은 유지됩니다.`)||!confirm(`정말로 계정을 삭제하시겠습니까?

이 작업은 다음을 포함합니다:
• 계정 정보 완전 삭제
• 모든 클라우드 데이터 삭제
• 모든 로컬 게임 저장 삭제

삭제 후에는 로그아웃되고 페이지가 새로고침됩니다.

이 작업은 되돌릴 수 없습니다.`))return;r(e==="hub"?"Deleting account…":"계정 삭제 중…");let t;try{t=await h()}catch(o){console.error("Delete account exception:",o),r("계정 삭제 중 오류가 발생했습니다. 네트워크 연결을 확인하고 다시 시도해주세요.");return}if(!t.ok){let o;t.status==="NOT_CONFIGURED"?o="계정 삭제 기능이 설정되지 않았습니다. 고객지원에 문의해주세요.":t.status==="AUTH_FAILED"?o="로그인 상태가 만료되었습니다. 다시 로그인해주세요.":t.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?o="데이터는 삭제되었지만 계정 삭제에 실패했습니다. 고객지원에 문의해주세요.":t.reason==="timeout"?o="요청 시간이 초과되었습니다. 네트워크 연결을 확인하고 다시 시도해주세요.":t.reason==="network_error"?o="네트워크 오류가 발생했습니다. 연결을 확인하고 다시 시도해주세요.":t.httpStatus===404?o="계정 삭제 기능이 아직 준비되지 않았습니다. 고객지원에 문의해주세요.":o=e==="hub"?`계정 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`:`계정 삭제 실패: ${t.reason||"알 수 없는 오류"}. 다시 시도해주세요.`,r(o),console.error("Delete account failed:",t);return}try{const o=["clicksurvivor-auth","seoulTycoonSaveV1"];Object.keys(localStorage).forEach(u=>{u.startsWith("clicksurvivor-")&&u!=="clicksurvivor_lang"&&o.push(u)}),o.forEach(u=>{try{localStorage.removeItem(u)}catch(v){console.warn(`Failed to remove localStorage key "${u}":`,v)}})}catch(o){console.warn("Failed to clear localStorage:",o)}r(e==="hub"?"Account deleted. Signing out…":"계정이 삭제되었습니다. 로그아웃 중…");try{await f()}catch(o){console.warn("Logout after account deletion failed (expected):",o)}setTimeout(()=>{window.location.reload()},1e3)}export{W as initAuthUI};

import{createClient as P}from"https://esm.sh/@supabase/supabase-js@2.49.1";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();const B={VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52eGR3YWNxbWlvZnBlbm51a2VvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4OTMwNDYsImV4cCI6MjA4MTQ2OTA0Nn0.v2UoOk7xdmascY10Oy8fT3kYTWm9gWKSC9C4wH4nwP4",VITE_SUPABASE_URL:"https://nvxdwacqmiofpennukeo.supabase.co"},w=typeof import.meta<"u"&&B?B:{},m=w.VITE_SUPABASE_URL??"",b=w.VITE_SUPABASE_ANON_KEY??"",x="clicksurvivor-auth";function U(){return typeof m=="string"&&typeof b=="string"&&m.startsWith("https://")&&m.length>8&&b.length>0}function N(){return U()?P(m,b,{auth:{storageKey:x,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}):null}let p=null;function h(){return p||(p=N(),p)}function y(){return U()}async function T(){const n=h();if(!n)return{ok:!1,reason:"not_configured"};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:o}=await n.auth.exchangeCodeForSession(location.href);if(o)return{ok:!1,reason:"exchange_failed",error:o};const r=new URL(location.href);return r.searchParams.delete("code"),r.searchParams.delete("state"),history.replaceState(null,"",r.toString()),{ok:!0,exchanged:!0}}catch(o){return{ok:!1,reason:"exchange_failed",error:o}}}async function Y(){const n=h();if(!n)return null;const{data:e}=await n.auth.getUser();return(e==null?void 0:e.user)||null}async function R(n){const e=h();if(!e)return{ok:!1,reason:"not_configured"};const o=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"),{error:r}=await e.auth.signInWithOAuth({provider:n,options:{redirectTo:o}});return r?{ok:!1,reason:"oauth_failed",error:r}:{ok:!0}}async function J(){const n=h();if(!n)return{ok:!1,reason:"not_configured"};const{error:e}=await n.auth.signOut();return e?{ok:!1,reason:"signout_failed",error:e}:{ok:!0}}function K(n){const e=h();if(!e)return()=>{};const{data:o}=e.auth.onAuthStateChange((r,t)=>{n((t==null?void 0:t.user)||null)});return()=>o.subscription.unsubscribe()}function V(n){var e,o,r,t;return n?((e=n.user_metadata)==null?void 0:e.full_name)||((o=n.user_metadata)==null?void 0:o.name)||((r=n.user_metadata)==null?void 0:r.preferred_username)||n.email||((t=n.id)==null?void 0:t.slice(0,8)):null}async function W(n){const{scope:e="hub",providerButtons:o=[],defaultProvider:r="google",loginBtn:t,logoutBtn:i,userLabel:u,statusLabel:c,toast:_}=n||{},f=typeof _=="function"?_:()=>{};await T();function v(s){const a=V(s);u&&(u.textContent=a||(e==="hub"?"Guest":"게스트"),u.hidden=!1),c&&(y()?a?(c.textContent=e==="hub"?"Signed in":"로그인됨",c.style.color="rgba(52, 211, 153, .95)"):(c.textContent=e==="hub"?"Not signed in":"로그인 안 됨",c.style.color="rgba(148, 163, 184, .95)"):(c.textContent=e==="hub"?"Guest mode (로그인 준비 중)":"게스트 모드 (로그인 준비 중)",c.style.color="rgba(148, 163, 184, .95)")),t&&(t.hidden=!!a),i&&(i.hidden=!a);const d=document.getElementById("authProviderButtons");d&&(d.style.display=a?"none":"flex");const g=document.getElementById("logoutButtonContainer");g&&(g.style.display=a?"flex":"none");const A=document.getElementById("authUserInfo");A&&(A.style.display=a?"block":"none");const L=document.getElementById("cloudSaveSection");L&&(L.style.display=a?"block":"none");const E=document.getElementById("guestSaveInfo");E&&(E.style.display=a?"none":"block")}const C=await Y();v(C);const O=K(s=>v(s));async function I(s){if(!y()){f("현재는 게스트 모드입니다. 로그인 기능은 준비 중입니다.");return}f(e==="hub"?"Redirecting…":"이동 중…"),(await R(s)).ok||f(e==="hub"?"Login failed":"로그인 실패")}async function k(){if(!y())return;(await J()).ok?f(e==="hub"?"Signed out":"로그아웃"):f(e==="hub"?"Logout failed":"로그아웃 실패")}return t&&t.addEventListener("click",s=>{s.preventDefault(),I(r)}),o.forEach(s=>{var d;const a=(d=s==null?void 0:s.dataset)==null?void 0:d.authProvider;a&&s.addEventListener("click",g=>{g.preventDefault(),I(a)})}),i&&i.addEventListener("click",s=>{s.preventDefault(),k()}),{off:O}}function l(n){return document.querySelector(n)}function S(n){const e=l("#toast");e&&(e.textContent=n,e.classList.add("show"),window.clearTimeout(S._t),S._t=window.setTimeout(()=>e.classList.remove("show"),1400))}function D(){return location.pathname.includes("/seoulsurvival/")?"game":"hub"}window.addEventListener("DOMContentLoaded",async()=>{const n=l("#loginBtn")||l("#authLoginBtn"),e=l("#logoutBtn")||l("#authLogoutBtn"),o=l("#authUserLabel"),r=l("#authStatusLabel"),t=Array.from(document.querySelectorAll("[data-auth-provider]"));!n&&t.length===0||await W({scope:D(),providerButtons:t,defaultProvider:"google",loginBtn:n,logoutBtn:e,userLabel:o,statusLabel:r,toast:S})});export{Y as a,U as b,N as g,y as i,K as o};

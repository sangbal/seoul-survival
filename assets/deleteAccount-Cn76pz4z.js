import{_ as E}from"./preload-helper-WPMeT1xN.js";import{g as f}from"./supabaseClient-BZSWgoCJ.js";import{getUser as d}from"./core-DFjEd1v7.js";import{releaseNickname as m}from"./leaderboard-BsZgAXtE.js";async function U(){const r=await f();if(!r)return{ok:!1,status:"NOT_CONFIGURED",reason:"not_configured"};const n=await d();if(!n)return{ok:!1,status:"AUTH_FAILED",reason:"not_signed_in"};try{const e=await m(n.id,"seoulsurvival");e.success?console.log("[DeleteAccount] Nickname released successfully (client-side)"):console.warn("[DeleteAccount] Nickname release failed (will be handled by Edge Function):",e.message)}catch(e){console.warn("[DeleteAccount] Nickname release exception (will be handled by Edge Function):",e)}const{data:{session:a},error:c}=await r.auth.getSession();if(c||!(a!=null&&a.access_token))return{ok:!1,status:"AUTH_FAILED",reason:"no_session",error:c};const u=a.access_token,{getSupabaseUrl:i}=await E(async()=>{const{getSupabaseUrl:e}=await import("./config-BXlfH7ts.js");return{getSupabaseUrl:e}},[],import.meta.url),l=`${i()}/functions/v1/delete-account`;try{const e=new AbortController,_=setTimeout(()=>e.abort(),3e4),t=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},signal:e.signal});if(clearTimeout(_),!t.ok){let s;try{s=await t.json()}catch{s={status:"UNKNOWN_ERROR",message:`HTTP ${t.status}`}}return{ok:!1,status:s.status||"UNKNOWN_ERROR",reason:s.message||`HTTP ${t.status}`,error:s,httpStatus:t.status}}const o=await t.json();return o.status==="ALL_SUCCESS"?{ok:!0,status:"ALL_SUCCESS"}:o.status==="DATA_DELETED_BUT_AUTH_DELETE_FAILED"?{ok:!1,status:"DATA_DELETED_BUT_AUTH_DELETE_FAILED",reason:"Data deleted but account deletion failed"}:{ok:!1,status:o.status||"UNKNOWN_ERROR",reason:o.message||"Unknown error"}}catch(e){return e.name==="AbortError"?{ok:!1,status:"UNKNOWN_ERROR",reason:"timeout",error:e}:(console.error("Delete account exception:",e),{ok:!1,status:"UNKNOWN_ERROR",reason:"network_error",error:e})}}export{U as deleteAccount};

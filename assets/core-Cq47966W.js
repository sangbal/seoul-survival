const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reviews-DG559Ksu.js","./supabaseClient-DfMY2obf.js","./preload-helper-Bo3zgFBI.js","./preload-helper-DFlHEO2w.css"])))=>i.map(i=>d[i]);
import{_ as l}from"./preload-helper-Bo3zgFBI.js";import{g}from"./supabaseClient-DfMY2obf.js";let i=null;async function o(){return i||(i=await g(),i)}async function b(){const{isSupabaseConfigured:t}=await l(async()=>{const{isSupabaseConfigured:e}=await import("./config-BXlfH7ts.js");return{isSupabaseConfigured:e}},[],import.meta.url);return t()}async function k(){const t=await o();if(!t)return{ok:!1,reason:"not_configured"};if(typeof location<"u"&&location.pathname==="/auth/callback")return{ok:!0,exchanged:!1};if(!(typeof location<"u"&&/[?&]code=/.test(location.search)))return{ok:!0,exchanged:!1};try{const{error:n}=await t.auth.exchangeCodeForSession(location.href);if(n)return{ok:!1,reason:"exchange_failed",error:n};const a=new URL(location.href);return a.searchParams.delete("code"),a.searchParams.delete("state"),history.replaceState(null,"",a.toString()),{ok:!0,exchanged:!0}}catch(n){return{ok:!1,reason:"exchange_failed",error:n}}}async function h(){const t=await o();if(!t)return null;const{data:e}=await t.auth.getUser();return(e==null?void 0:e.user)||null}async function _(t,e=null){const n=await o();if(!n)return{ok:!1,reason:"not_configured"};e||(e=location.origin+location.pathname+location.search.replace(/([?&])code=[^&]+(&|$)/,"$1").replace(/[?&]state=[^&]+(&|$)/,"$1"));const a={redirectTo:e};t==="google"&&(a.queryParams={prompt:"select_account"});const{error:r}=await n.auth.signInWithOAuth({provider:t,options:a});return r?{ok:!1,reason:"oauth_failed",error:r}:{ok:!0}}async function p(t=null){const e=`${location.origin}/auth/callback`;console.log("[signInGoogle] Current origin:",location.origin),console.log("[signInGoogle] Callback URL:",e);let n=e;if(t){const a=new URL(e);a.searchParams.set("next",t),n=a.toString()}return console.log("[signInGoogle] Final redirectTo:",n),_("google",n)}async function y(){const t=await o();if(!t)return{ok:!1,reason:"not_configured"};const{error:e}=await t.auth.signOut();return e?{ok:!1,reason:"signout_failed",error:e}:{ok:!0}}function w(t){return o().then(e=>{if(!e)return;const{data:n}=e.auth.onAuthStateChange((a,r)=>{t((r==null?void 0:r.user)||null)});typeof globalThis<"u"&&(globalThis.__clicksurvivor_auth_unsubscribe=()=>n.subscription.unsubscribe())}).catch(()=>{}),()=>{typeof globalThis<"u"&&globalThis.__clicksurvivor_auth_unsubscribe&&(globalThis.__clicksurvivor_auth_unsubscribe(),delete globalThis.__clicksurvivor_auth_unsubscribe)}}async function v(t="seoulsurvival"){var a,r,u;const e=await h();if(!e)return{success:!1,error:"not_signed_in"};const n={id:e.id,email:e.email||null,displayName:((a=e.user_metadata)==null?void 0:a.full_name)||((r=e.user_metadata)==null?void 0:r.name)||((u=e.user_metadata)==null?void 0:u.preferred_username)||e.email||null};try{const{getUserNickname:s}=await l(async()=>{const{getUserNickname:f}=await import("./reviews-DG559Ksu.js");return{getUserNickname:f}},__vite__mapDeps([0,1,2,3]),import.meta.url),c=await s(t);c.success&&(n.nickname=c.nickname)}catch(s){console.warn("[getUserProfile] Failed to get nickname:",s)}return{success:!0,user:n}}export{h as getUser,v as getUserProfile,k as initAuthFromUrl,b as isAuthEnabled,w as onAuthStateChange,p as signInGoogle,_ as signInWithOAuth,y as signOut};

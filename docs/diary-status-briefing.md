# 일기장 기능 현황 브리핑

## Executive Summary

일기장 기능은 게임 내 주요 이벤트(구매/판매/승진/해금 등)를 감성적 독백 형태로 변환하여 기록하는 시스템입니다. 시스템 메시지와 독백을 폰트/색상으로 시각적으로 분리하여 가독성을 확보했습니다.

## 핵심 질문

- 일기장은 어떤 기능인가?
- 어떤 이벤트가 기록되는가?
- 독백 변환 로직은 어떻게 동작하는가?
- UI/UX는 어떻게 구성되어 있는가?

## 전략 방향

1. **감성적 변환**: 시스템 메시지를 1인칭 독백으로 변환
2. **가시성 분리**: 독백(감성)과 정보(시스템)를 폰트/색상으로 구분
3. **컨텍스트 인식**: 상품/이벤트 유형에 따라 맞춤형 독백 생성
4. **중복 방지**: 동일 패턴 메시지의 연속 반복 방지

## 주요 과제

### 1. 구현 위치 및 구조

| 항목 | 내용 |
|------|------|
| **메인 함수** | `seoulsurvival/src/main.js`의 `addLog()` 함수 (라인 2139~2803) |
| **DOM 요소** | `#log` (클래스: `log diary-log`) |
| **헤더 메타** | `#diaryHeaderMeta` (형식: `yyyy.mm.dd(N일차)`) |
| **CSS 스타일** | `seoulsurvival/index.html` 내부 스타일 (라인 292~358) |

### 2. 메시지 변환 로직 (`diaryize` 함수)

시스템 메시지를 감성적 독백으로 변환하는 핵심 함수입니다.

#### 2.1 변환 대상 이벤트

| 이벤트 유형 | 감지 패턴 | 변환 예시 |
|------------|----------|----------|
| **업적 달성** | `🏆 업적 달성:` | "오늘은 체크 하나를 더했다. (업적명)" |
| **승진** | `🎉 ... 승진했습니다` | "명함이 바뀌었다. CEO." |
| **해금** | `🔓` | 상품별 맞춤형 독백 (예: "첫 '집'이라는 단어가 현실이 됐다.") |
| **구매** | `✅ ... 구입했습니다` | 상품별 맞춤형 독백 (예: "일단은 안전한 데에 묶어두자.") |
| **판매** | `💰 ... 판매했습니다` | 상품별 맞춤형 독백 (예: "손이 떨리기 전에 내렸다.") |
| **자금 부족** | `💸 자금이 부족합니다` | "지갑이 얇아서 아무것도 못 했다." |
| **시장 이벤트** | `📈 ... 발생` / `📉 ... 종료` | 상품별 맞춤형 독백 (예: "차트가 또 날 시험한다.") |
| **업그레이드** | `🎁 ... 해금` / `✅ ... 구매!` | 상품별 맞춤형 독백 |
| **경고** | `⚠️` | "찜찜한 기분이 남았다." |
| **기본** | 기타 | "그냥 적어둔다." / "오늘의 기록." |

#### 2.2 상품별 맞춤형 독백

각 상품 유형(예금/적금/주식/코인/부동산 등)에 따라 서로 다른 독백 풀을 제공합니다.

- **예금**: "일단은 안전한 데에 묶어두자." / "불안할 땐 예금이 답이다."
- **적금**: "루틴을 샀다. 매일이 쌓이면 언젠가." / "천천히, 꾸준히."
- **국내주식**: "차트가 나를 보더니 웃는 것 같았다." / "기대 반, 긴장 반."
- **미국주식**: "달러 환율부터 떠올랐다." / "밤에 울리는 알림을 각오했다."
- **코인**: "심장 단단히 붙잡고 탔다." / "오늘은 FOMO가 이겼다."
- **부동산**: 상품별로 세분화 (빌라/오피스텔/아파트/상가/빌딩)

#### 2.3 중복 방지 메커니즘

- `pick()` 함수: 동일 키에 대해 마지막 선택 인덱스를 저장 (`window.__diaryLastPick_${key}`)
- 연속 동일 선택 방지: 이전 선택과 같으면 다음 인덱스로 이동
- 시장 이벤트 컨텍스트 유지: `window.__diaryLastMarketProduct`, `window.__diaryLastMarketName`으로 이벤트-종료-메모 연결

#### 2.4 필터링 규칙

다음 메시지는 일기장에 기록되지 않습니다:

- 개발/디버깅 키워드 포함 메시지 (`🧪`, `v2.`, `v3.`, `Cookie Clicker` 등)
- 업그레이드 잔여 클릭 안내 메시지 (`다음 업그레이드 ... 클릭 남음`)

### 3. UI/UX 구성

#### 3.1 레이아웃

- **위치**: 노동 탭 내부, 커리어 진행률 카드 하단
- **컨테이너**: `.diary-card` (카드 스타일)
- **헤더**: "📓 일기장" + 날짜 메타 (`yyyy.mm.dd(N일차)`)
- **로그 영역**: `.diary-log` (최대 높이 240px, 스크롤 가능)

#### 3.2 시각적 분리

독백과 정보를 폰트/색상으로 구분합니다.

| 요소 | 클래스 | 스타일 |
|------|--------|--------|
| **독백 (1줄)** | `.diary-voice` | 색상: `var(--text)` (밝은 회색), 폰트: system-ui, font-weight: 500 |
| **정보 (2줄 이후)** | `.diary-info` | 색상: `var(--muted)` (어두운 회색), 폰트: ui-monospace (고정폭), font-size: 12px |
| **타임스탬프** | `.diary-time` | 색상: `var(--muted)`, 폰트: tabular-nums (숫자 정렬) |

#### 3.3 메시지 구조

각 일기장 항목은 다음과 같은 HTML 구조를 가집니다:

```html
<p>
  <span class="diary-time">14:23</span>
  <span class="diary-voice">명함이 바뀌었다. CEO.</span>
  <span class="diary-info">클릭당 1,000,000원</span>
</p>
```

- 첫 줄: 독백 (감성적 표현)
- 이후 줄: 정보 (시스템 메시지, 수치 등)

#### 3.4 반응형 디자인

- **모바일**: 일기장 높이 약간 축소 (DEVLOG.md 참조)
- **PC/태블릿**: 최대 높이 240px, 스크롤 가능

### 4. 메타데이터 관리

#### 4.1 날짜/일차 계산

- **기준 시간**: `gameStartTime` (있으면) 또는 `sessionStartTime` (없으면)
- **일차 계산**: `Math.floor((Date.now() - base) / 86400000) + 1`
- **표시 형식**: `yyyy.mm.dd(N일차)` (예: `2025.12.20(3일차)`)

#### 4.2 업데이트 시점

- 로그 추가 시마다 `updateDiaryMeta()` 호출
- 게임 상태 복원 시에도 메타 업데이트 (라인 4075)

### 5. 기술적 세부사항

#### 5.1 메시지 처리 흐름

1. `addLog(text)` 호출
2. 개발 메시지 필터링
3. 타임스탬프 생성 (`HH:mm` 형식)
4. `diaryize(text)`로 독백 변환
5. 첫 줄(독백)과 이후 줄(정보) 분리
6. HTML 요소 생성 및 `#log`에 prepend

#### 5.2 이스케이프 처리

- HTML 특수문자 이스케이프: `<` → `&lt;`, `>` → `&gt;`
- 줄바꿈 처리: `\n` 기준으로 분리하여 독백/정보 구분

#### 5.3 접근성

- `aria-label="일기장"` 속성 추가
- 스크린리더 지원을 위한 시맨틱 마크업

## 주요 개선 이력

| 날짜 | 변경 사항 | 출처 |
|------|----------|------|
| 2025-12-20 | 엔딩 시퀀스: 타워 구매 시 일기장에 기록 추가 | DEVLOG.md |
| - | 모바일: 일기장(로그) 높이 약간 축소 | DEVLOG.md |
| - | 독백(감성)과 시스템 메시지(정보)를 폰트/색으로 분리 | README.md |

## 향후 개선 가능 영역

1. **필터링 옵션**: 사용자가 특정 이벤트 유형만 보기
2. **검색 기능**: 일기장 내 텍스트 검색
3. **내보내기**: 일기장 내용을 텍스트 파일로 다운로드
4. **통계**: 일기장 기록 빈도, 주요 이벤트 분석
5. **개인화**: 사용자별 독백 스타일 선택 (감성/중립/정보 중심)

## 참고 파일

- 구현: `seoulsurvival/src/main.js` (라인 2139~2803)
- 스타일: `seoulsurvival/index.html` (라인 292~358)
- DOM 구조: `seoulsurvival/index.html` (라인 2344~2350)
- 문서: `README.md` (라인 33)






# E2E 테스트 보고서

**테스트 날짜**: 2025-12-19  
**테스트 대상**: 계정 삭제(회원 탈퇴) 기능  
**테스트 계정**: 별도 테스트용 Google 계정 사용 (본계정 아님)  
**배포 상태**: Edge Function `delete-account` ACTIVE

---

## [0] 사전 체크 결과

### ✅ URL 확인
- **파일**: `shared/auth/deleteAccount.js` 라인 29
- **구현**: `${SUPABASE_URL}/functions/v1/delete-account` (동적 생성)
- **환경 변수**: `SUPABASE_URL`은 `shared/auth/config.js`에서 `VITE_SUPABASE_URL`로부터 읽어옴
- **하드코딩**: 없음 ✅
- **판정**: PASS

### ✅ 버튼 위치 확인
- **파일**: `index.html` 라인 823
- **위치**: 계정 섹션(`#account`) 내부에만 존재 (`deleteAccountBtn`)
- **드로어**: "계정 관리" 링크만 존재, 버튼 없음 ✅
- **판정**: PASS

---

## [1] 시나리오 B: 정상 성공 (필수)

### 테스트 절차
1. `https://clicksurvivor.com` 접속
2. 테스트 Google 계정으로 로그인
3. 계정 섹션(`#account`)에서 "계정 삭제(회원 탈퇴)" 버튼 클릭
4. 2단계 confirm 진행:
   - 1단계: 삭제될 내용 확인
   - 2단계: 최종 확인
5. 프론트에서 `ALL_SUCCESS` 응답 확인
6. 로그아웃/리로드 확인
7. 동일 테스트 계정으로 재로그인 시도
8. Supabase Dashboard에서 DB 정합성 확인

### 코드 검증 결과

#### ✅ 2단계 Confirm 구현 확인
- **파일**: `shared/auth/ui.js` 라인 302-317
- **1단계**: 삭제될 내용 명시 (계정 정보, 클라우드 저장, 리더보드, 로컬 저장)
- **2단계**: 최종 확인 메시지
- **체크박스**: 현재 `confirm()` 사용 (체크박스 없음, 향후 개선 가능)
- **판정**: PASS (기본 요구사항 충족)

#### ✅ 에러 처리 구현 확인
- **파일**: `shared/auth/ui.js` 라인 333-368
- **상황별 메시지**:
  - `NOT_CONFIGURED`: "계정 삭제 기능이 설정되지 않았습니다. 고객지원에 문의해주세요."
  - `AUTH_FAILED`: "로그인 상태가 만료되었습니다. 다시 로그인해주세요."
  - `DATA_DELETED_BUT_AUTH_DELETE_FAILED`: "데이터는 삭제되었지만 계정 삭제에 실패했습니다. 고객지원에 문의해주세요."
  - `timeout`: "요청 시간이 초과되었습니다. 네트워크 연결을 확인하고 다시 시도해주세요."
  - `network_error`: "네트워크 오류가 발생했습니다. 연결을 확인하고 다시 시도해주세요."
  - `404`: "계정 삭제 기능이 아직 준비되지 않았습니다. 고객지원에 문의해주세요."
- **판정**: PASS

#### ✅ 성공 시 처리 구현 확인
- **파일**: `shared/auth/ui.js` 라인 370-408
- **로컬 저장소 정리**: 계정/세이브 관련 키만 삭제, 언어 설정 유지 ✅
- **로그아웃**: `doLogout()` 호출 (실패해도 계속 진행)
- **페이지 새로고침**: 1초 후 `window.location.reload()`
- **성공 메시지**: "계정이 삭제되었습니다. 로그아웃 중…"
- **판정**: PASS

### 실제 테스트 결과
- ⏳ **대기 중**: 테스트 계정으로 실제 테스트 필요

### 판정 기준
- ✅ 코드 검증: PASS
- ⏳ 실제 테스트: 대기 중

---

## [2] 시나리오 A: 미설정/오류 fallback

### 테스트 방법
- 네트워크 차단(offline) 또는 함수 URL 임시 변경으로 404/네트워크 오류 시뮬레이션

### 코드 검증 결과

#### ✅ 404 에러 처리
- **파일**: `shared/auth/ui.js` 라인 355-358
- **메시지**: "계정 삭제 기능이 아직 준비되지 않았습니다. 고객지원에 문의해주세요."
- **판정**: PASS

#### ✅ 네트워크 오류 처리
- **파일**: `shared/auth/ui.js` 라인 351-354
- **메시지**: "네트워크 오류가 발생했습니다. 연결을 확인하고 다시 시도해주세요."
- **판정**: PASS

#### ⚠️ "내 데이터 삭제"로 유도
- **현재 구현**: 없음
- **개선 제안**: 404/네트워크 오류 시 "내 데이터 삭제" 버튼을 강조하거나 안내 메시지 추가
- **판정**: 부분 PASS (기본 에러 처리만 있음)

### 실제 테스트 결과
- ⏳ **대기 중**: 네트워크 오프라인 모드로 테스트 필요

---

## [3] 시나리오 C: 부분 성공

### 코드 검증 결과

#### ✅ DATA_DELETED_BUT_AUTH_DELETE_FAILED 처리
- **파일**: `shared/auth/ui.js` 라인 343-346
- **메시지**: "데이터는 삭제되었지만 계정 삭제에 실패했습니다. 고객지원에 문의해주세요."
- **재시도 버튼**: 없음 (향후 개선 가능)
- **고객지원 링크**: 없음 (향후 개선 가능)
- **판정**: 부분 PASS (메시지는 명확하나 재시도/문의 안내 부족)

### 재현 방법 (참고)
- Edge Function에서 `admin.deleteUser()` 단계만 실패하도록 수정 (테스트용)
- 또는 Supabase 권한 설정으로 인한 실패 시뮬레이션
- ⚠️ 프로덕션 손상 없이 테스트 환경에서만 수행

### 실제 테스트 결과
- ⏳ **대기 중**: 부분 성공 조건 재현 후 테스트 필요

---

## [4] 회귀 테스트

### 테스트 항목

#### ✅ /seoulsurvival/ 로그인/로그아웃 UI
- **확인 방법**: 게임 페이지 접속 후 설정 탭에서 계정 섹션 확인
- **예상**: 로그인/로그아웃 버튼 정상 표시
- **판정**: ⏳ 테스트 필요

#### ✅ 리더보드 조회/표시
- **확인 방법**: 랭킹 탭에서 TOP 10 표시 확인
- **예상**: 리더보드 데이터 정상 로드 및 표시
- **판정**: ⏳ 테스트 필요

#### ✅ 클라우드 저장/불러오기
- **확인 방법**: 설정 탭에서 클라우드 저장/불러오기 버튼 동작 확인
- **예상**: 클라우드 저장 기능 정상 동작
- **판정**: ⏳ 테스트 필요

#### ✅ 모바일 가로 스크롤
- **확인 방법**: 모바일(360px)에서 가로 스크롤 없음 확인
- **예상**: 가로 스크롤 없음
- **판정**: ⏳ 테스트 필요

#### ✅ 햄버거 드로어 UX
- **확인 방법**: 모바일에서 햄버거 메뉴 열기/닫기, 스크롤 잠금 확인
- **예상**: 드로어 정상 동작, 스크롤 잠금 정상
- **판정**: ⏳ 테스트 필요

---

## [5] 발견된 버그/개선점

### 높은 우선순위
- 없음

### 중간 우선순위
1. **체크박스 추가**: 2단계 confirm에 체크박스 추가하여 실수 방지 강화
2. **재시도 버튼**: 부분 성공 시 재시도 버튼 제공
3. **고객지원 링크**: 에러 메시지에 고객지원 이메일/문의 링크 추가

### 낮은 우선순위
1. **"내 데이터 삭제" 유도**: 404/네트워크 오류 시 "내 데이터 삭제"로 유도하는 안내 추가

---

## 최종 판정

### 코드 검증 결과
- ✅ URL 동적 생성: PASS
- ✅ 버튼 위치: PASS
- ✅ 2단계 confirm: PASS
- ✅ 에러 처리: PASS
- ✅ 성공 시 처리: PASS
- ⚠️ 부분 성공 재시도/문의 안내: 부분 PASS

### 실제 테스트 상태
- ⏳ 시나리오 B: 대기 중 (테스트 계정 필요)
- ⏳ 시나리오 A: 대기 중 (네트워크 오프라인 테스트 필요)
- ⏳ 시나리오 C: 대기 중 (부분 성공 조건 재현 필요)
- ⏳ 회귀 테스트: 대기 중

### GO/NO-GO 판정
- ⏳ **대기 중**: 실제 테스트 완료 후 최종 판정
- **GO 조건**: 시나리오 B PASS + 회귀 테스트 PASS
- **NO-GO 조건**: 계정 삭제 실패, 데이터 잔존, 로그인 상태 꼬임, 보안 위반

---

## 다음 단계

1. **테스트 계정으로 실제 E2E 테스트 수행** (필수)
2. **회귀 테스트 수행** (필수)
3. **개선점 반영** (선택)

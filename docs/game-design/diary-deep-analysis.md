# 일기장 영역 심층 문제 분석

## Executive Summary

일기장 기능의 표면적 문제(저장/접근성)를 넘어, **구조적 설계 결함**, **사용자 경험 근본 문제**, **기술적 부채** 등 더 깊은 차원의 문제점을 발견했습니다. 본 문서는 이러한 근본 원인을 분석합니다.

## 핵심 질문

- 일기장의 구조적 설계 문제는 무엇인가?
- 사용자가 실제로 겪는 불편함의 근본 원인은?
- 기술적 부채는 어디에 있는가?

## 발견된 근본 문제

### 1. 위치적 접근성 문제: 노동 탭에만 고정

#### 현황
- 일기장이 **노동 탭(`#workTab`)에만 존재**
- 투자/통계/설정 탭에서는 일기장을 볼 수 없음
- 사용자가 다른 탭에서 활동 중에도 일기장을 보려면 노동 탭으로 이동해야 함

#### 근본 원인
```html
<!-- seoulsurvival/index.html 라인 2344~2350 -->
<div id="workTab" class="tab-content active">
  <!-- ... -->
  <div class="card diary-card" style="margin-top:12px">
    <h2>
      <span class="diary-title">📓 일기장</span>
      <!-- ... -->
    </h2>
    <div id="log" class="log diary-log" aria-label="일기장"></div>
  </div>
</div>
```

**설계 철학의 한계**:
- 일기장을 "노동 관련 로그"로만 인식
- 게임 전체의 스토리텔링 요소로 인식하지 못함
- 탭 구조와 일기장의 관계를 재고하지 않음

#### 영향도
- **높음**: 사용자가 투자/통계 탭에서 활동 중에도 일기장을 확인하려면 탭 전환 필요
- 게임의 흐름이 끊기는 경험

#### 실제 시나리오
1. 사용자가 투자 탭에서 상품 구매 → 일기장에 기록됨
2. 사용자가 일기장을 보려면 노동 탭으로 이동해야 함
3. 다시 투자 탭으로 돌아와야 함
4. **결과**: 불필요한 탭 전환 반복

---

### 2. 타임스탬프 정보 부족: 날짜 정보 없음

#### 현황
- 타임스탬프가 `HH:mm` 형식만 제공 (예: `14:23`)
- 날짜 정보가 없어 하루 이상 플레이 시 시간만으로는 구분 어려움
- 헤더에는 `yyyy.mm.dd(N일차)`가 있으나, 개별 메시지에는 날짜 없음

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2157~2159
const pad2 = (n) => String(n).padStart(2, '0');
const now = new Date();
const timeStamp = `${pad2(now.getHours())}:${pad2(now.getMinutes())}`;
```

**설계 철학의 한계**:
- 단일 세션 내에서만 사용할 것을 가정
- 장기 플레이 시나리오 미고려
- 시간 정보만으로도 충분하다고 판단

#### 영향도
- **중간**: 하루 이상 플레이 시 "어제 14:23"과 "오늘 14:23"을 구분 불가
- 장기 플레이 시 기록의 시간적 맥락 손실

---

### 3. 중복 방지 로직의 취약성: 새로고침 시 초기화

#### 현황
- 중복 방지 상태가 `window.__diaryLastPick_${key}`에 저장됨
- 새로고침 시 이 상태가 초기화되어 동일 메시지가 다시 반복될 수 있음

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2194~2204
const pick = (key, arr) => {
  const storeKey = `__diaryLastPick_${key}`;
  const last = window[storeKey]; // window 객체에만 저장
  // ...
  window[storeKey] = idx; // 새로고침 시 사라짐
  return arr[idx];
};
```

**설계 철학의 한계**:
- 중복 방지를 "세션 내"로만 제한
- 영구적 중복 방지 필요성 미인식
- 저장/불러오기와 연동하지 않음

#### 영향도
- **낮음**: 기능적 문제는 아니나, 사용자 경험 일관성 저하

---

### 4. 독백 풀의 다양성 부족: 반복 느낌

#### 현황
- 각 이벤트 유형당 독백 풀이 3~5개로 제한적
- 장기 플레이 시 동일한 독백이 반복되어 기계적 느낌

#### 근본 원인
```javascript
// 예: 구매 이벤트 (라인 2310~2373)
const buyByProduct = {
  '예금': [
    `일단은 안전한 데에 묶어두자.\n${body}`,
    `불안할 땐 예금이 답이다.\n${body}`,
    `통장에 '쿠션'을 하나 깔았다.\n${body}`,
  ],
  // ... 각 상품당 3개씩
};
```

**설계 철학의 한계**:
- 독백 풀을 하드코딩으로 관리
- 확장성/다양성 확보 방안 미고려
- 동적 생성/조합 로직 부재

#### 영향도
- **중간**: 장기 플레이 시 독백의 신선함 저하
- 게임의 감성적 요소가 약화될 수 있음

---

### 5. 컨텍스트 손실: 이벤트 간 연결 부재

#### 현황
- 시장 이벤트-종료-메모만 연결되어 있음 (`window.__diaryLastMarketProduct`)
- 다른 이벤트 간 연결은 없음
- 예: "구매 → 판매" 같은 연속 행동의 맥락이 끊김

#### 근본 원인
```javascript
// 시장 이벤트만 컨텍스트 유지 (라인 2470~2471)
window.__diaryLastMarketProduct = product;
window.__diaryLastMarketName = eventName || body;

// 다른 이벤트는 컨텍스트 없음
```

**설계 철학의 한계**:
- 이벤트를 독립적으로만 처리
- 이벤트 간 관계/흐름 인식 부족
- 스토리텔링 관점의 연결성 미고려

#### 영향도
- **낮음**: 기능적 문제는 아니나, 일기장의 스토리텔링 품질 저하

---

### 6. 성능 문제: 매번 DOM 조작

#### 현황
- 메시지 추가 시마다 `prepend()`로 DOM 조작
- 메시지가 많아질수록 DOM 트리가 무거워짐
- 가상 스크롤링 미적용

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2802
elLog.prepend(p); // 매번 DOM 조작
```

**설계 철학의 한계**:
- 단순한 구현으로 시작하여 성능 최적화 미고려
- 가상 스크롤링 같은 고급 기법 미적용
- 메시지 수가 적을 때는 문제 없으나, 장기 플레이 시 성능 저하 가능

#### 영향도
- **낮음**: 현재는 문제 없으나, 장기 플레이 시 잠재적 이슈

---

### 7. 메시지 변환 실패 시 조용한 무시

#### 현황
- `diaryize()` 함수가 빈 문자열을 반환하면 `addLog()`에서 조용히 return
- 변환 실패 원인을 사용자/개발자가 알 수 없음

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2789~2790
const diaryText = diaryize(text);
if (!diaryText) return; // 조용히 무시
```

**설계 철학의 한계**:
- 실패를 "정상적인 필터링"으로 처리
- 디버깅/모니터링 고려 부족
- 사용자에게 피드백 없음

#### 영향도
- **낮음**: 기능적 문제는 아니나, 디버깅 어려움

---

### 8. 개발 메시지 필터링의 하드코딩

#### 현황
- 개발 메시지 필터링 키워드가 하드코딩되어 있음
- 새로운 개발 메시지 패턴 추가 시 코드 수정 필요

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2141~2146
const devKeywords = [
  '🧪', 'v2.', 'v3.', 'Cookie Clicker', '업그레이드 시스템',
  // ... 하드코딩된 키워드 목록
];
```

**설계 철학의 한계**:
- 필터링 규칙을 확장 가능하게 설계하지 않음
- 설정/컨피그로 분리하지 않음

#### 영향도
- **낮음**: 유지보수성 저하

---

### 9. innerHTML 사용의 잠재적 위험

#### 현황
- `innerHTML`을 사용하여 메시지 삽입
- 이스케이프는 하고 있으나, 실수로 XSS 취약점이 생길 수 있음

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2801
p.innerHTML = `<span class="diary-time">${timeStamp}</span>${bodyHtml}`;
```

**설계 철학의 한계**:
- 편의성을 위해 `innerHTML` 사용
- `textContent` + DOM API 조합보다 덜 안전

#### 영향도
- **낮음**: 현재는 이스케이프하고 있어 문제 없으나, 잠재적 위험

---

### 10. 역순 정렬의 직관성 문제

#### 현황
- `prepend()`로 인해 최신 메시지가 위에 오는 역순 정렬
- 일부 사용자에게는 직관적이지 않을 수 있음

#### 근본 원인
```javascript
// seoulsurvival/src/main.js 라인 2802
elLog.prepend(p); // 최신이 위로
```

**설계 철학의 한계**:
- "최신이 위"가 항상 직관적이라고 가정
- 사용자 선택권 부여하지 않음

#### 영향도
- **낮음**: 대부분의 사용자는 문제 없으나, 일부는 혼란 가능

---

## 우선순위별 문제 정리

| 문제 | 영향도 | 근본성 | 개선 난이도 |
|------|--------|--------|------------|
| **1. 위치적 접근성** (노동 탭에만) | 높음 | 높음 | 중간 |
| **2. 타임스탬프 정보 부족** | 중간 | 중간 | 낮음 |
| **3. 중복 방지 취약성** | 낮음 | 중간 | 낮음 |
| **4. 독백 풀 다양성 부족** | 중간 | 중간 | 높음 |
| **5. 컨텍스트 손실** | 낮음 | 중간 | 높음 |
| **6. 성능 문제** | 낮음 | 낮음 | 중간 |
| **7. 변환 실패 무시** | 낮음 | 낮음 | 낮음 |
| **8. 필터링 하드코딩** | 낮음 | 낮음 | 낮음 |
| **9. innerHTML 사용** | 낮음 | 낮음 | 낮음 |
| **10. 역순 정렬** | 낮음 | 낮음 | 낮음 |

## 가장 근본적인 문제

### 문제 #1: 위치적 접근성 (노동 탭에만 고정)

이것이 가장 근본적이고 사용자 경험에 직접적인 영향을 미치는 문제입니다.

**이유**:
1. **사용자 워크플로우와 불일치**: 사용자는 여러 탭을 오가며 플레이하는데, 일기장은 한 곳에만 있음
2. **게임의 스토리텔링 요소로 인식 부족**: 일기장은 게임 전체의 스토리인데, 특정 탭에만 위치
3. **접근성 문제**: 다른 탭에서 활동 중에도 일기장을 보려면 불필요한 탭 전환 필요

**개선 방향**:
- 일기장을 독립적인 탭으로 분리하거나
- 모든 탭에서 접근 가능한 공통 영역으로 이동하거나
- 헤더/사이드바에 고정 배치

---

## 결론

일기장 영역의 가장 근본적인 문제는 **"위치적 접근성"**입니다. 일기장이 노동 탭에만 고정되어 있어, 사용자가 다른 탭에서 활동 중에도 일기장을 보려면 불필요한 탭 전환을 해야 합니다. 이는 게임의 흐름을 끊고 사용자 경험을 저하시킵니다.

다른 문제들(타임스탬프, 중복 방지, 독백 풀 등)도 중요하나, 위치적 접근성 문제가 가장 사용자 경험에 직접적이고 근본적인 영향을 미칩니다.

## 참고 파일

- 구현: `seoulsurvival/src/main.js` (라인 2139~2803)
- DOM 구조: `seoulsurvival/index.html` (라인 2344~2350, 2322~2352)
- 탭 구조: `seoulsurvival/index.html` (라인 2320~3000)

















# 타워 구매 시 사용자 경험 플로우

비개발자를 위한 타워 구매 과정 상세 설명서입니다.

---

## 📋 목차

1. [타워 구매 전 조건](#타워-구매-전-조건)
2. [타워 구매 순간](#타워-구매-순간)
3. [타워 구매 직후](#타워-구매-직후)
4. [엔딩 모달](#엔딩-모달)
5. [게임 리셋 선택](#게임-리셋-선택)
6. [리셋 후 상태](#리셋-후-상태)
7. [전체 플로우 다이어그램](#전체-플로우-다이어그램)

---

## 타워 구매 전 조건

### ✅ 해금 조건
사용자가 서울타워를 구매하려면 다음 조건을 모두 충족해야 합니다:

1. **CEO 달성**
   - 커리어 레벨 9 (CEO) 달성 필요
   - 약 15,000번의 클릭 필요

2. **빌딩 1개 이상 보유**
   - 빌딩은 상가를 1개 이상 보유해야 해금됨
   - 상가는 아파트를 1개 이상 보유해야 해금됨
   - 아파트는 오피스텔을 1개 이상 보유해야 해금됨
   - 오피스텔은 빌라를 1개 이상 보유해야 해금됨
   - 빌라는 코인을 1개 이상 보유해야 해금됨

3. **자금 1조원 이상**
   - 서울타워 가격: **1조원 (고정)**
   - 가격이 변하지 않음 (항상 1조원)

### 📌 UI 상태
- **해금 전**: 서울타워 카드가 회색으로 표시되고 "잠금" 상태
- **해금 후**: 서울타워 카드가 정상 색상으로 표시되고 구매 가능
- **자금 부족**: 구매 버튼이 비활성화되거나 "자금이 부족합니다" 메시지 표시

---

## 타워 구매 순간

### 1️⃣ 구매 버튼 클릭
사용자가 서울타워 구매 버튼을 클릭합니다.

### 2️⃣ 구매 처리
게임이 다음 작업을 수행합니다:

| 작업 | 설명 | 결과 |
|------|------|------|
| **현금 차감** | 1조원 차감 | 예: 1조 5천억원 → 5천억원 |
| **타워 개수 증가** | `towers += 1` | 예: 0개 → 1개 |
| **게임 상태 업데이트** | 타워 구매 완료 상태로 변경 | - |

### 3️⃣ 즉시 리더보드 업데이트
- **조건**: 닉네임이 설정되어 있어야 함
- **전송 정보**:
  - 닉네임
  - 총 자산 (타워 구매 비용 차감 후)
  - 플레이타임
  - 타워 개수 (누적)
- **결과**: 리더보드에 즉시 반영됨

---

## 타워 구매 직후

### 1️⃣ 일기장 기록
일기장에 다음 메시지가 자동으로 기록됩니다:

```
🗼 서울타워 완성.
서울의 정상에 도달했다.
이제야 진짜 시작인가?
```

### 2️⃣ 파티클 애니메이션
- 설정에서 파티클 효과가 켜져 있으면
- 화면에 🗼 이모지가 떨어지는 애니메이션이 재생됩니다
- 축하 효과로 표시됩니다

### 3️⃣ UI 업데이트
- **헤더**: 타워 배지가 표시됩니다 (예: 🗼x1)
- **게임 화면**: 모든 UI 요소가 업데이트됩니다
- **서울타워 카드**: 구매 완료 상태로 표시됩니다

### 4️⃣ 게임 자동 저장
- 게임 데이터가 자동으로 저장됩니다
- 타워 개수가 저장 데이터에 포함됩니다

---

## 엔딩 모달

### 📌 모달 표시
타워 구매 직후 화면 중앙에 엔딩 모달이 표시됩니다.

### 📌 모달 내용

**제목**: 🎉 엔딩

**메시지**:
```
🗼 서울타워 완성 🗼

알바에서 시작해 CEO까지.
예금에서 시작해 서울타워까지.

서울 한복판에 당신의 이름이 새겨졌다.

"이제야 진짜 시작인가?"

리더보드에 기록되었습니다: 🗼x1
```

(타워 개수는 실제 구매한 개수에 따라 표시됩니다)

### 📌 모달 버튼
- **확인 버튼**: 클릭 시 다음 단계로 진행

---

## 게임 리셋 선택

### 1️⃣ 확인 다이얼로그
엔딩 모달의 확인 버튼을 클릭하면, 다음 확인 다이얼로그가 표시됩니다:

**제목**: 🔄 새 게임 시작

**메시지**:
```
서울타워를 완성했습니다!

새 게임을 시작하시겠습니까?
(현재 진행은 초기화됩니다)
```

### 2️⃣ 선택 옵션

#### ✅ "새 게임 시작" 선택 시
- 게임이 완전히 초기화됩니다
- 모든 자산, 진행 상황이 삭제됩니다
- **하지만 타워 개수는 유지됩니다** (리더보드에 누적됨)
- 일기장에 "🗼 새로운 시작. 다시 한 번." 메시지 기록
- 페이지가 새로고침되어 새 게임이 시작됩니다

#### ❌ "나중에" 선택 시
- 게임이 계속 진행됩니다
- 타워를 구매한 상태로 게임을 계속 플레이할 수 있습니다
- 리더보드 업데이트도 계속됩니다 (타워 구매 후에도 업데이트됨)

---

## 리셋 후 상태

### 📌 게임 상태
- **자산**: 0원 (또는 시작 자산)
- **커리어**: 초기 상태
- **보유 자산**: 모두 0개
- **업적**: 모두 잠금 상태
- **플레이타임**: 리셋 전까지의 누적 시간 유지

### 📌 리더보드 상태
- **타워 개수**: **누적되어 유지됨**
  - 예: 첫 번째 타워 구매 → 리셋 → 두 번째 타워 구매 → 리더보드에는 🗼x2
- **자산**: 0원 또는 시작 자산으로 업데이트됨
- **플레이타임**: 누적 시간 유지
- **순위**: 타워 개수가 많을수록 상위 순위

### 📌 다음 타워 구매
- 다시 CEO 달성 및 빌딩 1개 이상 보유 필요
- 다시 1조원 모으기 필요
- 타워를 구매하면 타워 개수가 누적됩니다 (🗼x1 → 🗼x2 → 🗼x3)

---

## 전체 플로우 다이어그램

```
[게임 플레이]
    ↓
[CEO 달성 + 빌딩 1개 이상 보유]
    ↓
[1조원 모으기]
    ↓
[서울타워 구매 버튼 클릭]
    ↓
┌─────────────────────────┐
│ 타워 구매 처리           │
│ - 현금 1조원 차감        │
│ - 타워 개수 +1           │
│ - 리더보드 즉시 업데이트 │
└─────────────────────────┘
    ↓
┌─────────────────────────┐
│ 즉시 발생                │
│ - 일기장 기록            │
│ - 파티클 애니메이션      │
│ - UI 업데이트            │
│ - 게임 자동 저장         │
└─────────────────────────┘
    ↓
┌─────────────────────────┐
│ 엔딩 모달 표시           │
│ "서울타워 완성"          │
└─────────────────────────┘
    ↓
[확인 버튼 클릭]
    ↓
┌─────────────────────────┐
│ 확인 다이얼로그          │
│ "새 게임 시작하시겠습니까?"│
└─────────────────────────┘
    ↓
    ├─→ [새 게임 시작] ──→ [게임 리셋] ──→ [새 게임 시작]
    │                           ↓
    │                    [타워 개수 유지]
    │                           ↓
    │                    [리더보드: 🗼x1]
    │
    └─→ [나중에] ──→ [게임 계속 진행]
                            ↓
                    [리더보드 계속 업데이트]
                            ↓
                    [다음 타워 구매 가능]
```

---

## 타임라인 요약

| 시간 | 이벤트 | 사용자가 보는 것 |
|------|--------|-----------------|
| **0초** | 구매 버튼 클릭 | - |
| **0.1초** | 현금 차감, 타워 개수 증가 | 화면 숫자 변화 |
| **0.2초** | 리더보드 업데이트 시작 | - |
| **0.3초** | 일기장 기록, 파티클 애니메이션 | 🗼 떨어지는 애니메이션 |
| **0.5초** | 엔딩 모달 표시 | "서울타워 완성" 모달 |
| **사용자 클릭** | 확인 버튼 클릭 | - |
| **+1초** | 확인 다이얼로그 표시 | "새 게임 시작하시겠습니까?" |
| **사용자 선택** | 새 게임 시작 또는 나중에 | - |

---

## 중요 사항

### ✅ 타워 개수는 누적됩니다
- 타워를 구매할 때마다 타워 개수가 누적됩니다
- 게임을 리셋해도 타워 개수는 유지됩니다
- 리더보드에 🗼x1, 🗼x2, 🗼x3 형태로 표시됩니다

### ✅ 리더보드 순위
- 타워 개수가 많은 순서로 정렬됩니다
- 같은 타워 개수 내에서는 자산이 많은 순서로 정렬됩니다

### ✅ 게임 리셋 후
- 모든 게임 진행 상황이 초기화됩니다
- 하지만 타워 개수는 계속 누적되어 리더보드에 표시됩니다
- 다시 타워를 구매하면 타워 개수가 증가합니다

### ⚠️ 현재 알려진 문제
- 타워 개수가 리더보드에 저장되지 않을 수 있음 (서버 함수 수정 필요)
- 리더보드 UI에 타워 개수가 표시되지 않을 수 있음 (UI 수정 필요)

---

**마지막 업데이트**: 2024년 (현재 코드 기준)















# 리더보드 동기화 케이스 가이드

비개발자를 위한 리더보드 동기화 설명서입니다.

---

## 📋 목차

1. [리더보드 동기화란?](#리더보드-동기화란)
2. [동기화되는 모든 케이스](#동기화되는-모든-케이스)
3. [각 케이스별 상세 설명](#각-케이스별-상세-설명)
4. [리더보드에 표시되는 정보](#리더보드에-표시되는-정보)
5. [동기화가 안 되는 경우](#동기화가-안-되는-경우)

---

## 리더보드 동기화란?

**리더보드 동기화**는 게임 내에서 달성한 기록(자산, 플레이타임 등)을 서버의 리더보드에 업데이트하는 과정입니다.

- **게임 내 저장**: 브라우저에 저장되는 개인 게임 데이터
- **리더보드**: 모든 플레이어의 기록을 비교할 수 있는 공개 순위표

리더보드에 기록이 올라가야 다른 플레이어들과 순위를 비교할 수 있습니다.

---

## 동기화되는 모든 케이스

리더보드 동기화는 다음 상황에서 발생합니다:

### ✅ 자동 동기화 (게임이 알아서 처리)

1. **5초마다 자동 저장 시** (30초마다 리더보드 업데이트)
2. **타워 구매 시** (즉시 업데이트)

### ✅ 수동 동기화 (사용자 행동에 의해)

3. **닉네임 설정 시** (게임 저장과 함께 업데이트)
4. **게임 리셋 시** (게임 저장과 함께 업데이트)

---

## 각 케이스별 상세 설명

### 케이스 1: 5초마다 자동 저장 시 (30초마다 리더보드 업데이트)

#### 📌 언제 발생하나요?
- 게임을 플레이하는 동안 **5초마다** 게임 데이터가 자동으로 저장됩니다.
- 이 중에서 **30초가 지난 경우에만** 리더보드가 업데이트됩니다.

#### 📌 동기화 조건
- ✅ **닉네임이 설정되어 있어야 함**
  - 닉네임이 없으면 리더보드에 표시할 이름이 없으므로 업데이트하지 않습니다.
- ✅ **마지막 리더보드 업데이트로부터 30초 이상 경과**
  - 너무 자주 업데이트하면 서버에 부하가 가므로 30초 간격으로 제한합니다.

#### 📌 리더보드에 전송되는 정보
| 항목 | 설명 | 예시 |
|------|------|------|
| **닉네임** | 리더보드에 표시될 이름 | "홍길동" |
| **총 자산** | 현금 + 보유 자산의 현재 가치 | 1,234,567,890원 |
| **플레이타임** | 게임을 플레이한 총 시간 | 2시간 30분 |

#### 📌 리더보드에 어떻게 인식되나요?
- **처음 기록하는 경우**: 리더보드에 새로운 항목이 추가됩니다.
- **이미 기록이 있는 경우**: 기존 기록이 새로운 값으로 업데이트됩니다.
- **순위 변화**: 자산이 증가하면 순위가 올라갈 수 있습니다.

#### 📌 주의사항
- 타워 개수는 **현재 전송되지 않습니다** (수정 필요)
- 네트워크 오류가 발생하면 업데이트가 실패할 수 있습니다 (사용자에게 알림 없음)

---

### 케이스 2: 타워 구매 시 (즉시 업데이트)

#### 📌 언제 발생하나요?
- 서울타워를 구매하는 순간 **즉시** 리더보드가 업데이트됩니다.

#### 📌 동기화 조건
- ✅ **닉네임이 설정되어 있어야 함**
- ✅ **타워 구매 비용을 지불할 수 있어야 함**
- ✅ **타워 구매 조건 충족** (CEO 달성 및 빌딩 1개 이상 보유)

#### 📌 리더보드에 전송되는 정보
| 항목 | 설명 | 예시 |
|------|------|------|
| **닉네임** | 리더보드에 표시될 이름 | "홍길동" |
| **총 자산** | 타워 구매 직후의 자산 (타워 구매 비용 차감 후) | 500,000,000원 |
| **플레이타임** | 게임을 플레이한 총 시간 | 3시간 15분 |
| **타워 개수** | 구매한 총 타워 개수 (누적) | 1개 → 2개 → 3개 |

#### 📌 리더보드에 어떻게 인식되나요?
- **타워 개수 증가**: 타워를 구매할 때마다 타워 개수가 누적됩니다.
  - 예: 첫 번째 타워 구매 → 🗼x1
  - 예: 두 번째 타워 구매 → 🗼x2
  - 예: 세 번째 타워 구매 → 🗼x3
- **순위 변화**: 타워 개수가 많을수록 순위가 높아집니다.
  - 타워 3개 > 타워 2개 > 타워 1개 > 타워 0개
  - 같은 타워 개수 내에서는 자산이 많은 순서
- **게임 리셋 후에도**: 타워 개수는 계속 누적되어 표시됩니다.
  - 예: 타워 1개 구매 → 게임 리셋 → 다시 타워 1개 구매 → 리더보드에는 🗼x2로 표시

#### 📌 주의사항
- **현재 문제**: 타워 구매 시 리더보드 업데이트 코드가 타워 개수를 전달하지만, 서버 함수가 타워 개수를 받지 않아 저장되지 않습니다 (수정 필요)
- 타워 구매 후 게임을 리셋해도 타워 개수는 계속 누적됩니다.

---

### 케이스 3: 닉네임 설정 시

#### 📌 언제 발생하나요?
- 게임을 처음 시작하거나 닉네임이 없을 때 닉네임을 설정하면, 게임이 저장되면서 리더보드도 업데이트됩니다.

#### 📌 동기화 조건
- ✅ **닉네임이 유효해야 함**
  - 1~5자
  - 공백, %, _ 문자 불가
  - 다른 사람이 사용 중인 닉네임 불가 (대소문자 구분 없음)

#### 📌 리더보드에 전송되는 정보
| 항목 | 설명 | 예시 |
|------|------|------|
| **닉네임** | 방금 설정한 닉네임 | "홍길동" |
| **총 자산** | 현재 보유 자산 | 100,000원 |
| **플레이타임** | 게임을 플레이한 총 시간 | 5분 |

#### 📌 리더보드에 어떻게 인식되나요?
- **처음 닉네임 설정**: 리더보드에 새로운 항목이 추가됩니다.
- **닉네임 변경**: 기존 기록의 닉네임이 변경됩니다 (같은 구글 계정 기준).

---

### 케이스 4: 게임 리셋 시

#### 📌 언제 발생하나요?
- 게임을 리셋(초기화)하면 게임 데이터가 저장되면서 리더보드도 업데이트됩니다.

#### 📌 동기화 조건
- ✅ **닉네임이 설정되어 있어야 함**
- ✅ **리셋 확인을 해야 함**

#### 📌 리더보드에 전송되는 정보
| 항목 | 설명 | 예시 |
|------|------|------|
| **닉네임** | 기존 닉네임 유지 | "홍길동" |
| **총 자산** | 리셋 후 초기 자산 (0원 또는 시작 자산) | 0원 |
| **플레이타임** | 리셋 전까지의 누적 플레이타임 | 5시간 |

#### 📌 리더보드에 어떻게 인식되나요?
- **자산 초기화**: 리더보드의 자산이 0원 또는 시작 자산으로 업데이트됩니다.
- **플레이타임 유지**: 리셋해도 플레이타임은 누적되어 유지됩니다.
- **타워 개수 유지**: 타워 개수는 리셋해도 유지됩니다 (해당 구글 계정 기준).

---

## 리더보드에 표시되는 정보

리더보드에는 다음 정보가 표시됩니다:

| 항목 | 설명 | 표시 예시 |
|------|------|-----------|
| **순위** | 전체 플레이어 중 순위 | 1위, 2위, 3위... |
| **닉네임** | 리더보드에 표시될 이름 | "홍길동" |
| **자산** | 총 자산 (현금 + 보유 자산) | 1,234,567,890원 |
| **플레이타임** | 게임을 플레이한 총 시간 | 2시간 30분 |
| **타워 개수** | 구매한 총 타워 개수 | 🗼x3 (현재 표시 안 됨, 수정 필요) |

### 순위 결정 기준

1. **타워 개수가 많은 순서** (우선순위 1)
   - 타워 3개 > 타워 2개 > 타워 1개 > 타워 0개
2. **같은 타워 개수 내에서는 자산이 많은 순서** (우선순위 2)
   - 타워 2개, 자산 10억 > 타워 2개, 자산 5억

---

## 동기화가 안 되는 경우

다음 경우에는 리더보드가 업데이트되지 않습니다:

### ❌ 닉네임이 없을 때
- 리더보드에 표시할 이름이 없으므로 업데이트하지 않습니다.
- **해결 방법**: 닉네임을 설정하세요.

### ❌ 로그인하지 않았을 때
- 리더보드는 구글 계정과 연결되어 있으므로 로그인이 필요합니다.
- **해결 방법**: 구글 계정으로 로그인하세요.

### ❌ 네트워크 오류
- 인터넷 연결이 끊어지거나 서버 오류가 발생하면 업데이트가 실패합니다.
- **현재 상태**: 실패해도 사용자에게 알림이 없습니다 (수정 필요)

### ❌ 30초 간격 제한
- 자동 저장은 5초마다 되지만, 리더보드 업데이트는 30초마다만 됩니다.
- **정상 동작**: 서버 부하를 줄이기 위한 제한입니다.

### ❌ 타워 구매 후 업데이트 중단 (이전 문제, 현재 수정됨)
- ~~타워를 구매하면 리더보드 업데이트가 중단되었습니다.~~
- **현재 상태**: 타워 구매 후에도 계속 업데이트됩니다 (수정 완료)

---

## 요약

### 리더보드 동기화는 언제 되나요?

1. ✅ **5초마다 자동 저장 시** (30초마다 리더보드 업데이트)
2. ✅ **타워 구매 시** (즉시 업데이트)
3. ✅ **닉네임 설정 시** (게임 저장과 함께)
4. ✅ **게임 리셋 시** (게임 저장과 함께)

### 리더보드에 표시되는 정보

- 순위, 닉네임, 자산, 플레이타임, 타워 개수 (현재 타워 개수는 표시 안 됨, 수정 필요)

### 동기화 조건

- 닉네임이 있어야 함
- 로그인되어 있어야 함
- 네트워크 연결이 되어 있어야 함

---

## 현재 알려진 문제

1. **타워 개수가 리더보드에 저장되지 않음**
   - 타워 구매 시 타워 개수를 전달하지만, 서버 함수가 받지 않아 저장되지 않습니다.
   - 리더보드 UI에도 타워 개수가 표시되지 않습니다.

2. **리더보드 업데이트 실패 시 사용자 알림 없음**
   - 네트워크 오류 등으로 업데이트가 실패해도 사용자가 알 수 없습니다.

3. **동기화 스크립트의 자산 계산 오류**
   - 관리자가 수동으로 동기화할 때 사용하는 SQL 스크립트의 자산 계산이 게임 내 로직과 다릅니다.

---

**마지막 업데이트**: 2024년 (현재 코드 기준)
















